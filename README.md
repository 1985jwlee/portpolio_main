# Event-driven Real-time Game Platform Architecture

## ì´ë²¤íŠ¸ ê¸°ë°˜ ì‹¤ì‹œê°„ ê²Œì„ í”Œë«í¼ ì•„í‚¤í…ì²˜ ì„¤ê³„ ì‚¬ë¡€

**ëŒ€ìƒ ì¥ë¥´**: ìºì£¼ì–¼ ì‹¤ì‹œê°„ ê²Œì„  
**í™•ì¥ ê°€ëŠ¥ ë²”ìœ„**: MO, MMO-lite, ëŒ€ê·œëª¨ ì´ë²¤íŠ¸ ê¸°ë°˜ ê²Œì„

-----

## ğŸ“Œ í¬íŠ¸í´ë¦¬ì˜¤ ê°œìš”

ë³¸ í¬íŠ¸í´ë¦¬ì˜¤ëŠ” íŠ¹ì • ê¸°ëŠ¥ êµ¬í˜„ì´ë‚˜ ì½”ë“œ ìˆ™ë ¨ë„ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•œ ë¬¸ì„œê°€ ì•„ë‹™ë‹ˆë‹¤.

ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ í™˜ê²½ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì§ˆë¬¸ì— ëŒ€í•´ **ì–´ë–¤ íŒë‹¨ì„ ë‚´ë¦¬ê³ , ì–´ë–¤ êµ¬ì¡°ë¥¼ ì„ íƒí–ˆëŠ”ì§€**ë¥¼ ì„¤ëª…í•˜ê¸° ìœ„í•œ **â€œì„¤ê³„ ì¤‘ì‹¬ í¬íŠ¸í´ë¦¬ì˜¤â€**ì…ë‹ˆë‹¤.

### ì´ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ í†µí•´ ì¦ëª…í•˜ê³ ì í•˜ëŠ” ê²ƒ

- âœ… ì‹¤ì‹œê°„ ì‹œìŠ¤í…œì—ì„œì˜ ì±…ì„ ë¶„ë¦¬ íŒë‹¨ ëŠ¥ë ¥
- âœ… ì„œë²„ ê¶Œí•œ(Server-authoritative) êµ¬ì¡°ì— ëŒ€í•œ ì´í•´
- âœ… ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ ì„¤ê³„ ì‚¬ê³ 
- âœ… ì¥ì• , ë³µêµ¬, ìš´ì˜ê¹Œì§€ í¬í•¨í•œ êµ¬ì¡°ì  ì‚¬ê³ 
- âœ… **ê°œì¸ì´ ì•„ë‹Œ ì¡°ì§ì— ë‚¨ëŠ” ì‹œìŠ¤í…œì„ ì„¤ê³„í•˜ëŠ” ê´€ì **

### ëŒ€ìƒ ë…ì

- CTO
- í…Œí¬ ë¦¬ë“œ
- ì‹œë‹ˆì–´ ë°±ì—”ë“œ / ì„œë²„ ì—”ì§€ë‹ˆì–´
- ì‹œìŠ¤í…œ ì„¤ê³„ ì¤‘ì‹¬ ë©´ì ‘ê´€

-----

## ğŸ“‹ ëª©ì°¨

- [1. ë¬¸ì œ ì •ì˜ (Why)](#1-ë¬¸ì œ-ì •ì˜-why)
- [2. ì „ì²´ ì‹œìŠ¤í…œ ê°œìš”](#2-ì „ì²´-ì‹œìŠ¤í…œ-ê°œìš”-big-picture)
- [3. í•µì‹¬ ì„¤ê³„ ì›ì¹™](#3-í•µì‹¬-ì„¤ê³„-ì›ì¹™)
- [4. ì£¼ìš” ì•„í‚¤í…ì²˜ êµ¬ì„±](#4-ì£¼ìš”-ì•„í‚¤í…ì²˜-êµ¬ì„±)
- [5. ìš´ì˜ ê´€ì  ì„¤ê³„](#5-ìš´ì˜-ê´€ì -ì„¤ê³„-operational-view)
- [6. í™•ì¥ ì‹œë‚˜ë¦¬ì˜¤](#6-í™•ì¥-ì‹œë‚˜ë¦¬ì˜¤)
- [7. ëŒ€ì•ˆ ë¹„êµì™€ ì„ íƒ ì´ìœ ](#7-ëŒ€ì•ˆ-ë¹„êµì™€-ì„ íƒ-ì´ìœ )
- [8. ë‚˜ì˜ ì±…ì„ ë²”ìœ„](#8-ë‚˜ì˜-ì±…ì„-ë²”ìœ„)
- [9. í•œ ë¬¸ì¥ ìš”ì•½](#9-í•œ-ë¬¸ì¥-ìš”ì•½)
- [ìƒì„¸ ë¬¸ì„œ](#-ìƒì„¸-ë¬¸ì„œ)

-----

## 1. ë¬¸ì œ ì •ì˜ (Why)

ë§ì€ ê²Œì„ ë° ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ëŠ” ê¸°ëŠ¥ ë‹¨ìœ„ êµ¬í˜„ì— ì§‘ì¤‘í•œ ë‚˜ë¨¸ì§€ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œë¥¼ ë°˜ë³µì ìœ¼ë¡œ ê²ªìŠµë‹ˆë‹¤.

```
ğŸš¨ ì‚¬ìš©ì ì´ë²¤íŠ¸ ì¦ê°€ì— ë”°ë¥¸ ì„œë²„ ë³µì¡ë„ í­ì¦
ğŸš¨ ì‹¤ì‹œê°„ ì²˜ë¦¬ì™€ ê¸°ë¡ ì²˜ë¦¬ì˜ ê²½ê³„ ë¶ˆëª…í™•
ğŸš¨ ì¥ì•  ë°œìƒ ì‹œ ì˜í–¥ ë²”ìœ„ê°€ ì˜ˆì¸¡ë˜ì§€ ì•ŠìŒ
ğŸš¨ íŠ¹ì • ê°œë°œìì—ê²Œ ìš´ì˜ê³¼ êµ¬ì¡° ì´í•´ê°€ ì§‘ì¤‘ë¨
ğŸš¨ ê¸°ëŠ¥ ì¶”ê°€ ì‹œ ê¸°ì¡´ ë¡œì§ì˜ ì•ˆì •ì„±ì´ ì§€ì†ì ìœ¼ë¡œ í›¼ì†ë¨
```

ì´ ì‹œìŠ¤í…œì€ **â€œê¸°ëŠ¥ì„ ë” ì˜ ë§Œë“œëŠ” ë°©ë²•â€**ì´ ì•„ë‹ˆë¼, **â€œì‹œìŠ¤í…œì´ ë³µì¡í•´ì ¸ë„ ë¬´ë„ˆì§€ì§€ ì•Šê²Œ ë§Œë“œëŠ” ë°©ë²•â€**ì„ í•´ê²° ëŒ€ìƒìœ¼ë¡œ ì‚¼ìŠµë‹ˆë‹¤.

### í•µì‹¬ íŒë‹¨

> **ë¬¸ì œì˜ í•µì‹¬ì€ ê¸°ìˆ  ë¶€ì¡±ì´ ì•„ë‹ˆë¼ êµ¬ì¡° ë¶€ì¬ë¼ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.**

-----

## 2. ì „ì²´ ì‹œìŠ¤í…œ ê°œìš” (Big Picture)

### í•µì‹¬ ëª©í‘œ

```
âœ“ ì‹¤ì‹œê°„ íŒì •ì˜ ì•ˆì •ì„± í™•ë³´
âœ“ ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì¸í•œ ì¥ì•  ì „íŒŒ ìµœì†Œí™”
âœ“ ìš´ì˜ê³¼ í™•ì¥ì´ ê°€ëŠ¥í•œ êµ¬ì¡°
âœ“ ìºì£¼ì–¼ ê²Œì„ì— ì í•©í•˜ì§€ë§Œ MMOê¹Œì§€ í™•ì¥ ê°€ëŠ¥í•œ ì„¤ê³„
```

### ì „ì²´ êµ¬ì„± ìš”ì†Œ

```
[ Unity ê²Œì„ í´ë¼ì´ì–¸íŠ¸ ]
        â†“ TCP/IP
[ C# ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ ]
        â†“ Domain Events
[ Kafka ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ ]
        â†“
[ TypeScript í”Œë«í¼ ì„œë²„ ]
        â†“
[ Redis / MongoDB / MySQL ]
        â†“
[ React ìš´ì˜ ëŒ€ì‹œë³´ë“œ ]
```

### ì¤‘ìš”í•œ ê°œë…ì  ë¶„ë¦¬

|êµ¬ë¶„        |ì±…ì„                   |
|----------|---------------------|
|**ì‹¤ì‹œê°„ ì²˜ë¦¬**|ê²Œì„ ì„œë²„ ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ íŒì •    |
|**ë¹„ë™ê¸° ì²˜ë¦¬**|Kafkaë¥¼ í†µí•œ ì´ë²¤íŠ¸ ê¸°ë¡ ë° í™•ì¥|
|**íŒì • ì±…ì„** |ê²Œì„ ì„œë²„ ë‹¨ë… ìˆ˜í–‰          |
|**ê¸°ë¡ ì±…ì„** |í”Œë«í¼ ì„œë²„ ë‹´ë‹¹            |
|**ê²Œì„ ì„œë²„** |ì‹¤ì‹œê°„ ë¡œì§, ìƒíƒœ ê´€ë¦¬        |
|**í”Œë«í¼ ì„œë²„**|ì´ë²¤íŠ¸ ì²˜ë¦¬, DB ì—°ë™, API ì œê³µ|

-----

## 3. í•µì‹¬ ì„¤ê³„ ì›ì¹™

ì´ ì‹œìŠ¤í…œì„ ê´€í†µí•˜ëŠ” ì„¤ê³„ ê¸°ì¤€ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

### 5ëŒ€ ì›ì¹™

```
1. ì‹¤ì‹œê°„ íŒì •ì€ ë°˜ë“œì‹œ ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ í™•ì •í•œë‹¤
2. ê¸°ë¡ê³¼ í™•ì¥ì€ ì´ë²¤íŠ¸ë¡œ ë¶„ë¦¬í•œë‹¤
3. ì¥ì• ëŠ” ì „íŒŒë˜ì§€ ì•Šê³  êµ­ì†Œí™”ë˜ì–´ì•¼ í•œë‹¤
4. ê¸°ëŠ¥ ì¶”ê°€ê°€ ê¸°ì¡´ íë¦„ì„ ê¹¨ì§€ ì•Šì•„ì•¼ í•œë‹¤
5. ìš´ì˜ìê°€ ì‹œìŠ¤í…œì„ "ì´í•´í•  ìˆ˜ ìˆì–´ì•¼" í•œë‹¤
```

### ì˜ë„ì ìœ¼ë¡œ ì„ íƒí•˜ì§€ ì•Šì€ ê²ƒë“¤

```
âœ— ëª¨ë“  ì²˜ë¦¬ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë§Œë“¤ì§€ ì•ŠìŒ
âœ— ì´ˆê¸°ë¶€í„° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
âœ— ê²Œì„ ì„œë²„ì—ì„œ DB íŠ¸ëœì­ì…˜ì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ
```

**ì´ ì„ íƒë“¤ì€ ë‹¨ìˆœí•œ ê¸°ìˆ  ì·¨í–¥ì´ ì•„ë‹ˆë¼, ìš´ì˜ ë³µì¡ë„ì™€ ì‹¤íŒ¨ ë¹„ìš©ì„ ê³ ë ¤í•œ íŒë‹¨ì˜ ê²°ê³¼ì…ë‹ˆë‹¤.**

-----

## 4. ì£¼ìš” ì•„í‚¤í…ì²˜ êµ¬ì„±

### 4-1. í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ì˜ ê²½ê³„

**ì„¤ê³„ ì² í•™**: Server-authoritative (ì„œë²„ ê¶Œí•œ)

```
í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í• :
- "ì˜ë„"ë§Œ ì „ë‹¬í•œë‹¤ (MoveRequest, AttackRequest)
- ìƒíƒœ ë³€ê²½ ê¶Œí•œì€ ì—†ë‹¤
- ì„œë²„ ì‘ë‹µì„ ê¸°ë‹¤ë¦°ë‹¤
- ì„œë²„ê°€ ìŠ¹ì¸í•œ ìƒíƒœë§Œ ë Œë”ë§

ì„œë²„ì˜ ì—­í• :
- ìƒíƒœ ë³€ê²½ ê¶Œí•œì€ ì„œë²„ì—ë§Œ ì¡´ì¬í•œë‹¤
- í´ë¼ì´ì–¸íŠ¸ ìƒíƒœëŠ” ì–¸ì œë“  ì„œë²„ ê¸°ì¤€ìœ¼ë¡œ êµì • ê°€ëŠ¥í•˜ë‹¤
- ëª¨ë“  íŒì •ì„ ìˆ˜í–‰í•œë‹¤
- ì¹˜íŠ¸ ë°©ì§€ëŠ” êµ¬ì¡°ì ìœ¼ë¡œ í•´ê²°ë¨
```

**ì™œ ì´ë ‡ê²Œ ì„¤ê³„í–ˆëŠ”ê°€?**

í´ë¼ì´ì–¸íŠ¸ì— ê¶Œí•œì„ ì£¼ëŠ” ìˆœê°„, ë‹¤ìŒ ë¬¸ì œê°€ ë°œìƒí•©ë‹ˆë‹¤:

- ë©”ëª¨ë¦¬ í•´í‚¹ìœ¼ë¡œ ìƒíƒœ ì¡°ì‘ ê°€ëŠ¥
- í´ë¼ì´ì–¸íŠ¸ ê°„ ë™ê¸°í™” ë¶ˆì¼ì¹˜
- íŒì • ê²°ê³¼ì— ëŒ€í•œ ì‹ ë¢°ì„± ìƒì‹¤

**ì„œë²„ ê¶Œí•œ ëª¨ë¸ì€ ë³µì¡í•´ì„œê°€ ì•„ë‹ˆë¼, ì•ˆì •ì„±ì„ ìœ„í•´ ì„ íƒí•œ êµ¬ì¡°ì…ë‹ˆë‹¤.**

### 4-2. ê²Œì„ ì„œë²„ êµ¬ì¡°

**ê¸°ìˆ  ìŠ¤íƒ**: C#, TCP/IP, MessagePack, Redis, MongoDB, Kafka

#### íŒ¨í‚· ì²˜ë¦¬ íŒŒì´í”„ë¼ì¸

```
1. Deserialization (ë¹„ì‹ ë¢° ì˜ì—­)
   â†“
2. Authentication / Session ê²€ì¦
   â†“
3. Rate Limiting (í”Œë ˆì´ì–´ë³„, IPë³„)
   â†“
4. Command Validation
   â†“
5. Command Queue ì ì¬
   â†“
6. GameLoop Tickì—ì„œ Domain ì²˜ë¦¬
   â†“
7. Domain Event ìƒì„±
   â†“
8. Kafka Publishing (Fire-and-Forget)
```

#### Command Validation ì˜ˆì‹œ

```csharp
public class MoveCommandValidator
{
    public ValidationResult Validate(MoveCommand cmd, Player player)
    {
        // 1. ë²”ìœ„ ê²€ì¦
        if (!IsWithinMapBounds(cmd.Position))
            return ValidationResult.Fail("Out of bounds");
        
        // 2. ê±°ë¦¬ ê²€ì¦ (í…”ë ˆí¬íŠ¸ ë°©ì§€)
        var distance = Vector3.Distance(player.Position, cmd.Position);
        if (distance > player.MaxMoveDistance)
            return ValidationResult.Fail("Move distance too large");
        
        // 3. ìƒíƒœ ê²€ì¦
        if (player.IsDead || player.IsStunned)
            return ValidationResult.Fail("Cannot move in current state");
        
        // 4. ì¿¨ë‹¤ìš´ ê²€ì¦
        if (player.LastMoveTime + player.MoveCooldown > CurrentTime)
            return ValidationResult.Fail("Move on cooldown");
        
        return ValidationResult.Success();
    }
}
```

**í•µì‹¬ ê²°ì •**:

- **ë‹¨ì¼ GameLoop + Command Queue êµ¬ì¡°**
- **Packet â†’ Command â†’ Domain â†’ Event íë¦„**
- **ì‹¤ì‹œê°„ íŒì •ì€ ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ì²˜ë¦¬**

**ë‹¨ì¼ ìŠ¤ë ˆë“œë¥¼ ì„ íƒí•œ ì´ìœ **:

- ë™ì‹œì„± ë²„ê·¸ ì›ì²œ ì°¨ë‹¨
- ìƒíƒœ ì¼ê´€ì„± ë³´ì¥
- ë””ë²„ê¹… ë° ì¶”ì  ìš©ì´
- ì„±ëŠ¥ì€ Zone ë¶„ì‚°ìœ¼ë¡œ í•´ê²°

### 4-3. ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼ ì„¤ê³„

**ê¸°ìˆ  ìŠ¤íƒ**: Kafka

#### Command vs Event

|êµ¬ë¶„       |Command   |Domain Event  |
|---------|----------|--------------|
|**ì˜ë¯¸**   |â€œí•´ë‹¬ë¼â€ (ìš”ì²­)|â€œì´ë¯¸ ì¼ì–´ë‚¬ë‹¤â€ (ì‚¬ì‹¤)|
|**ì‹œì **   |ë¯¸ë˜        |ê³¼ê±°            |
|**ì‹¤íŒ¨**   |ê°€ëŠ¥        |ë¶ˆê°€ëŠ¥ (ì´ë¯¸ ë°œìƒí•¨)  |
|**ìƒíƒœ ë³€ê²½**|ìš”ì²­í•¨       |í•˜ì§€ ì•ŠìŒ         |
|**ìš©ë„**   |ê²Œì„ ë¡œì§ ì‹¤í–‰  |ê¸°ë¡ ë° ì—°ë™       |

#### Event ì„¤ê³„ ì˜ˆì‹œ

```
âœ… ì¢‹ì€ Event ì´ë¦„:
- PlayerMovedEvent
- PlayerDiedEvent
- ItemAcquiredEvent
- MatchCompletedEvent

âŒ ë‚˜ìœ Event ì´ë¦„:
- MovePlayerCommand
- KillPlayer
- GiveItemCommand
```

#### Kafka Topic êµ¬ì¡°

```
game.events.player          # í”Œë ˆì´ì–´ ìƒíƒœ ë³€ê²½
game.events.combat          # ì „íˆ¬ ë¡œê·¸
game.events.economy         # ì¬í™” ë³€ë™
game.events.match           # ë§¤ì¹˜ ê²°ê³¼
game.snapshot.zone          # Zone ìŠ¤ëƒ…ìƒ·
platform.commands           # í”Œë«í¼â†’ê²Œì„ ì§€ì‹œ
```

**íŒŒí‹°ì…˜ ì „ëµ**:

- Key: PlayerId ë˜ëŠ” ZoneId
- ìˆœì„œ ë³´ì¥ì´ í•„ìš”í•œ ì´ë²¤íŠ¸ëŠ” ë™ì¼ íŒŒí‹°ì…˜ í• ë‹¹

**Consumer Group**:

```
Analytics Service    â†’ í†µê³„ ë° ë¶„ì„
Persistence Service  â†’ DB ì €ì¥
Notification Service â†’ í‘¸ì‹œ ì•Œë¦¼
Admin Dashboard      â†’ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
```

**í•µì‹¬ ì›ì¹™**:

> **ê²Œì„ ì„œë²„ëŠ” Kafkaì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.**

```csharp
// âŒ ì˜ëª»ëœ ì˜ˆì‹œ (ë™ê¸° ì²˜ë¦¬)
public void ProcessMove(MoveCommand cmd)
{
    player.Move(cmd.Position);
    
    var evt = new PlayerMovedEvent { ... };
    await kafka.Publish(evt);  // âŒ ëŒ€ê¸°í•˜ë©´ ì•ˆ ë¨!
    
    SendResponse(player.Position);
}

// âœ… ì˜¬ë°”ë¥¸ ì˜ˆì‹œ (ë¹„ë™ê¸° ì²˜ë¦¬)
public void ProcessMove(MoveCommand cmd)
{
    player.Move(cmd.Position);
    
    var evt = new PlayerMovedEvent { ... };
    kafka.PublishAsync(evt);  // âœ… Fire-and-Forget
    
    SendResponse(player.Position);  // ì¦‰ì‹œ ì‘ë‹µ
}
```

**ì™œ ê¸°ë‹¤ë¦¬ì§€ ì•ŠëŠ”ê°€?**

- GameLoop Tickì´ DB/Kafka ì§€ì—°ì— ì˜í–¥ë°›ìœ¼ë©´ ì•ˆ ë¨
- íŒì •ì€ ë©”ëª¨ë¦¬ì—ì„œ ì´ë¯¸ í™•ì •ë¨
- ê¸°ë¡ ì‹¤íŒ¨ê°€ ê²Œì„í”Œë ˆì´ë¥¼ ë§‰ì•„ì„œëŠ” ì•ˆ ë¨

### 4-4. í”Œë«í¼ ì„œë²„ êµ¬ì¡°

**ê¸°ìˆ  ìŠ¤íƒ**: TypeScript, bun.js, ElysiaJS, Kafka, MySQL, Drizzle ORM

```
[ Kafka Consumer ]
    â†“ Event Handling
[ Business Logic ]
    â†“
[ Database (MySQL) ]
    â†“
[ REST API / WebSocket ]
```

**ì—­í•  ë¶„ë¦¬**:

```
í”Œë«í¼ ì„œë²„ê°€ í•˜ëŠ” ê²ƒ:
âœ“ Kafka ì´ë²¤íŠ¸ ìˆ˜ì‹  ë° ì²˜ë¦¬
âœ“ DB ì˜ì†í™” (ë¹„ë™ê¸°)
âœ“ ìš´ì˜ API ì œê³µ
âœ“ í†µê³„ ë° ë¶„ì„
âœ“ ê´€ë¦¬ì ê¸°ëŠ¥

í”Œë«í¼ ì„œë²„ê°€ í•˜ì§€ ì•ŠëŠ” ê²ƒ:
âœ— ê²Œì„ ë¡œì§ ì‹¤í–‰
âœ— ì‹¤ì‹œê°„ íŒì •
âœ— ê²Œì„ ì„œë²„ ìƒíƒœ ê´€ë¦¬
```

**Idempotency ì²˜ë¦¬ ì˜ˆì‹œ**:

```typescript
// ì¤‘ë³µ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë°©ì§€
async function handleRewardEvent(event: RewardGrantedEvent) {
  const key = `event:${event.eventId}`;
  
  // ì´ë¯¸ ì²˜ë¦¬ëœ ì´ë²¤íŠ¸ì¸ì§€ í™•ì¸
  const processed = await redis.get(key);
  if (processed) {
    logger.info(`Event already processed: ${event.eventId}`);
    return;
  }
  
  // ì²˜ë¦¬
  await grantReward(event.playerId, event.amount);
  
  // ì²˜ë¦¬ ì™„ë£Œ ê¸°ë¡ (TTL: 1ì‹œê°„)
  await redis.setex(key, 3600, 'processed');
}
```

### 4-5. ë°ì´í„° ê³„ì¸µ ì „ëµ

#### ì´ì¤‘ ìŠ¤ëƒ…ìƒ· êµ¬ì¡°

|ì €ì¥ì†Œ        |ì—­í•            |ì£¼ê¸°    |TTL |ë³µêµ¬ ì‹œê°„|
|-----------|-------------|------|----|-----|
|**Redis**  |Hot Snapshot |5~10ì´ˆ |2~5ë¶„|ìˆ˜ì´ˆ   |
|**MongoDB**|Cold Snapshot|1~5ë¶„  |-   |ìˆ˜ë¶„   |
|**MySQL**  |ì˜ì† ë°ì´í„°       |ì´ë²¤íŠ¸ ê¸°ë°˜|-   |-    |

#### Redis (Hot Snapshot)

```
í‚¤ êµ¬ì¡°:
snapshot:zone:{zoneId}
snapshot:player:{playerId}
snapshot:session:{sessionId}

ìš©ë„:
- ê²Œì„ ì„œë²„ í¬ë˜ì‹œ ì‹œ ë¹ ë¥¸ ë³µêµ¬
- ì„¸ì…˜ ê´€ë¦¬
- Rate Limiting ì¹´ìš´í„°
```

#### MongoDB (Cold Snapshot)

```json
// Document ì˜ˆì‹œ
{
  "_id": "zone_1_20240115_143000",
  "zoneId": "zone_1",
  "timestamp": 1705304600,
  "players": [...],
  "entities": [...],
  "checksum": "abc123..."
}
```

**ìš©ë„**:

- ì„œë²„ ì ê²€ ì‹œ ë³µêµ¬
- Redis ì¥ì•  ì‹œ ë³µêµ¬
- íˆìŠ¤í† ë¦¬ ë¶„ì„

#### MySQL (ì˜ì† ë°ì´í„°)

```
í…Œì´ë¸” ì„¤ê³„:
- accounts (ê³„ì • ì •ë³´)
- inventory (ì¸ë²¤í† ë¦¬)
- transactions (ì¬í™” ê±°ë˜ ë‚´ì—­)
- match_history (ë§¤ì¹˜ ê¸°ë¡)
```

**íŠ¸ëœì­ì…˜ ì‚¬ìš© ì‹œì **:

- ì¬í™” ì°¨ê°/ì§€ê¸‰ (ACID ë³´ì¥ í•„ìš”)
- ê²°ì œ ì²˜ë¦¬
- ì¤‘ìš” ìš´ì˜ ë°ì´í„°

#### ë³µêµ¬ ìš°ì„ ìˆœìœ„

```
1ìˆœìœ„: Redis Snapshot (ìˆ˜ì´ˆ ë‚´ ë³µêµ¬)
    â†“ ì‹¤íŒ¨ ì‹œ
2ìˆœìœ„: MongoDB Snapshot (ìˆ˜ë¶„ ë‚´ ë³µêµ¬)
    â†“ ì‹¤íŒ¨ ì‹œ
3ìˆœìœ„: ì´ˆê¸° ìƒíƒœ + Kafka Event Replay
```

**í•µì‹¬ ì›ì¹™**:

> **ê²Œì„ ì„œë²„ëŠ” DB ì„±ê³µ/ì‹¤íŒ¨ì— ì˜ì¡´í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

ì´ëŠ” ì„±ëŠ¥ë¿ ì•„ë‹ˆë¼ **ì¥ì•  ê²©ë¦¬**ë¥¼ ìœ„í•œ ê²°ì •ì…ë‹ˆë‹¤.

-----

## 5. ìš´ì˜ ê´€ì  ì„¤ê³„ (Operational View)

ì´ ì„¤ê³„ëŠ” **â€œì¥ì• ê°€ ë‚˜ì§€ ì•ŠëŠ” ê²ƒâ€**ë³´ë‹¤ **â€œì¥ì• ê°€ ë‚˜ë„ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ ë™ì‘í•˜ëŠ” ê²ƒâ€**ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

### ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ë³„ ë³µêµ¬ ì „ëµ

#### 1. ê²Œì„ ì„œë²„ í¬ë˜ì‹œ

```
[ ì¥ì•  ë°œìƒ ]
    â†“
[ Redis Hot Snapshot ë¡œë“œ ]
    â†“ (ìˆ˜ì´ˆ)
[ í”Œë ˆì´ì–´ ì„¸ì…˜ ë³µì› ]
    â†“
[ ê²Œì„ ì¬ê°œ ]
```

**ë³µêµ¬ ì‹œê°„**: ìˆ˜ì´ˆ  
**ë°ì´í„° ì†ì‹¤**: ìµœëŒ€ 5~10ì´ˆ (ë§ˆì§€ë§‰ ìŠ¤ëƒ…ìƒ· ì´í›„)

#### 2. Redis ì¥ì• 

```
[ Redis ë‹¤ìš´ ê°ì§€ ]
    â†“
[ MongoDB Cold Snapshot ë¡œë“œ ]
    â†“ (ìˆ˜ë¶„)
[ í”Œë ˆì´ì–´ ìƒíƒœ ë³µì› ]
    â†“
[ ìµœê·¼ 5ë¶„ ì´ë‚´ ë°ì´í„° Kafkaë¡œ ë³´ì • ]
```

**ë³µêµ¬ ì‹œê°„**: ìˆ˜ë¶„  
**ë°ì´í„° ì†ì‹¤**: Kafka Event Replayë¡œ ìµœì†Œí™”

#### 3. í”Œë«í¼ ì„œë²„ ì¥ì• 

```
[ í”Œë«í¼ ì„œë²„ ë‹¤ìš´ ]
    â†“
[ ê²Œì„ ì„œë²„: ì˜í–¥ ì—†ìŒ ]
    â†“
[ Kafka ì´ë²¤íŠ¸ ëˆ„ì  ]
    â†“
[ í”Œë«í¼ ì„œë²„ ë³µêµ¬ í›„ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì¬ê°œ ]
```

**ê²Œì„í”Œë ˆì´ ì˜í–¥**: ì—†ìŒ  
**ê¸°ë¡ ì§€ì—°**: ì¼ì‹œì  (ë³µêµ¬ í›„ ìë™ ì²˜ë¦¬)

#### 4. Kafka ì¥ì• 

```
[ Kafka ë‹¤ìš´ ]
    â†“
[ ê²Œì„ ì„œë²„: ì˜í–¥ ì—†ìŒ ]
    â†“
[ ê²Œì„í”Œë ˆì´ ì •ìƒ ì§„í–‰ ]
    â†“
[ ì´ë²¤íŠ¸ëŠ” ë©”ëª¨ë¦¬ ë²„í¼ì— ì„ì‹œ ì €ì¥ ]
    â†“
[ Kafka ë³µêµ¬ í›„ ì¼ê´„ ì „ì†¡ ]
```

**ê²Œì„í”Œë ˆì´ ì˜í–¥**: ì—†ìŒ  
**ê¸°ë¡ ì†ì‹¤**: ì¥ì‹œê°„ ì¥ì•  ì‹œ ì¼ë¶€ ê°€ëŠ¥ (í—ˆìš© ë²”ìœ„)

#### 5. DB (MySQL) ì¥ì• 

```
[ MySQL ë‹¤ìš´ ]
    â†“
[ ê²Œì„ ì„œë²„: ì˜í–¥ ì—†ìŒ ]
    â†“
[ í”Œë«í¼ ì„œë²„: ì½ê¸° ìš”ì²­ë§Œ ì‹¤íŒ¨ ]
    â†“
[ ê²Œì„í”Œë ˆì´ ì •ìƒ ì§„í–‰ ]
```

**ê²Œì„í”Œë ˆì´ ì˜í–¥**: ì—†ìŒ  
**API ì˜í–¥**: ì¼ë¶€ ìš´ì˜ API ì‹¤íŒ¨

### ì¥ì•  ì˜í–¥ë„ ë§¤íŠ¸ë¦­ìŠ¤

|ì¥ì•  ëŒ€ìƒ  |ê²Œì„í”Œë ˆì´  |ê¸°ë¡     |ìš´ì˜ API |ë³µêµ¬ ë‚œì´ë„|
|-------|-------|-------|-------|------|
|ê²Œì„ ì„œë²„  |ğŸ”´ ì¤‘ë‹¨   |ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨|ğŸŸ¢ ì •ìƒ   |ë‚®ìŒ    |
|Redis  |ğŸŸ¡ ìˆœê°„ ì§€ì—°|ğŸŸ¢ ì •ìƒ   |ğŸŸ¢ ì •ìƒ   |ë‚®ìŒ    |
|MongoDB|ğŸŸ¢ ì •ìƒ   |ğŸŸ¢ ì •ìƒ   |ğŸŸ¢ ì •ìƒ   |ë‚®ìŒ    |
|Kafka  |ğŸŸ¢ ì •ìƒ   |ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨|ğŸŸ¢ ì •ìƒ   |ì¤‘ê°„    |
|MySQL  |ğŸŸ¢ ì •ìƒ   |ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨|ğŸ”´ ì¼ë¶€ ì‹¤íŒ¨|ì¤‘ê°„    |
|í”Œë«í¼ ì„œë²„ |ğŸŸ¢ ì •ìƒ   |ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨|ğŸ”´ ì¤‘ë‹¨   |ë‚®ìŒ    |

**ì„¤ê³„ ì² í•™**:

> **ê²Œì„í”Œë ˆì´ëŠ” ì–´ë–¤ ë°±ì—”ë“œ ì¥ì• ì—ë„ ë©ˆì¶”ì§€ ì•ŠìŠµë‹ˆë‹¤.**

### ë¬´ì¤‘ë‹¨ ë°°í¬ ì „ëµ

#### Rolling Update í”„ë¡œì„¸ìŠ¤

```
1. ìƒˆ ë²„ì „ ê²Œì„ ì„œë²„ ê¸°ë™
   â†“
2. Health Check í†µê³¼ í™•ì¸
   â†“
3. Load Balancerì— ì‹ ê·œ ì„œë²„ ë“±ë¡
   â†“
4. ì‹ ê·œ ì ‘ì†ìë§Œ ìƒˆ ì„œë²„ í• ë‹¹
   â†“
5. ê¸°ì¡´ ì„œë²„ëŠ” í”Œë ˆì´ì–´ 0ëª…ê¹Œì§€ ëŒ€ê¸°
   â†“
6. ìŠ¤ëƒ…ìƒ· ì €ì¥
   â†“
7. Graceful Shutdown
```

**ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸**:

```
ë°°í¬ ì „:
â˜ ë²„ì „ í˜¸í™˜ì„± ê²€ì¦
â˜ í”„ë¡œí† ì½œ ë³€ê²½ì‚¬í•­ í™•ì¸
â˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
â˜ Rollback ê³„íš ìˆ˜ë¦½

ë°°í¬ ì¤‘:
â˜ ìƒˆ ë²„ì „ ì„œë²„ Health Check
â˜ ì‹ ê·œ ì ‘ì† ëª¨ë‹ˆí„°ë§
â˜ ì—ëŸ¬ ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
â˜ ë©”ëª¨ë¦¬/CPU ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§

ë°°í¬ í›„:
â˜ êµ¬ë²„ì „ ì„œë²„ ì™„ì „ ì¢…ë£Œ í™•ì¸
â˜ ìŠ¤ëƒ…ìƒ· ì €ì¥ ì„±ê³µ í™•ì¸
â˜ 24ì‹œê°„ ëª¨ë‹ˆí„°ë§
â˜ ì¥ì•  ëŒ€ì‘ ì¤€ë¹„ íƒœì„¸ ìœ ì§€
```

### ìš´ì˜ ëŒ€ì‹œë³´ë“œ

**ê¸°ìˆ  ìŠ¤íƒ**: React, TypeScript, Zustand

#### ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ í•­ëª©

```
ì‹œìŠ¤í…œ ë©”íŠ¸ë¦­:
âœ“ Zoneë³„ ë™ì ‘ì ìˆ˜ (CCU)
âœ“ ê²Œì„ ì„œë²„ CPU/Memory ì‚¬ìš©ë¥ 
âœ“ GameLoop Tick ì§€ì—° (Target: < 50ms)
âœ“ Command Queue ê¸¸ì´

ë„¤íŠ¸ì›Œí¬ ë©”íŠ¸ë¦­:
âœ“ ì´ˆë‹¹ íŒ¨í‚· ìˆ˜ (In/Out)
âœ“ í‰ê·  RTT (Round-Trip Time)
âœ“ íŒ¨í‚· ì†ì‹¤ë¥ 
âœ“ ì—°ê²° ì‹¤íŒ¨ìœ¨

ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­:
âœ“ ë§¤ì¹˜ ì„±ê³µë¥ 
âœ“ í‰ê·  ë§¤ì¹˜ ì‹œê°„
âœ“ ì¬í™” íšë“/ì†Œë¹„ ë¹„ìœ¨
âœ“ ì´íƒˆë¥ 
```

#### ê²½ë³´ ì¡°ê±´

```
ğŸš¨ Critical (ì¦‰ì‹œ ëŒ€ì‘):
- ê²Œì„ ì„œë²„ ë‹¤ìš´
- Tick > 100ms ì§€ì† 30ì´ˆ
- CCU ê¸‰ë½ (30% ì´ìƒ)

âš ï¸ Warning (í™•ì¸ í•„ìš”):
- Command Queue > 1000
- Snapshot ì‹¤íŒ¨ ì—°ì† 3íšŒ
- Kafka Consumer Lag > 10000

â„¹ï¸ Info (ê´€ì°°):
- ì‹ ê·œ ë²„ì „ ë°°í¬
- ì •ê¸° ì ê²€ ì‹œì‘/ì¢…ë£Œ
- ìŠ¤ëƒ…ìƒ· ì €ì¥ ì™„ë£Œ
```

### ì¬í•´ ë³µêµ¬ í›ˆë ¨ (DR Drill)

**ì£¼ê¸°**: ë¶„ê¸°ë³„ 1íšŒ

**ì‹œë‚˜ë¦¬ì˜¤**:

```
1. Redis ê°•ì œ ì¤‘ë‹¨ ì‹œë‚˜ë¦¬ì˜¤
2. MongoDB ê°•ì œ ì¤‘ë‹¨ ì‹œë‚˜ë¦¬ì˜¤
3. ì „ì²´ ì¸í”„ë¼ ì¬êµ¬ì„± ì‹œë‚˜ë¦¬ì˜¤
```

**ëª©í‘œ**:

- RTO (Recovery Time Objective) ì¸¡ì •
- ë³µêµ¬ ì ˆì°¨ ê²€ì¦
- ìš´ì˜íŒ€ í›ˆë ¨

-----

## 6. í™•ì¥ ì‹œë‚˜ë¦¬ì˜¤

ì´ ì•„í‚¤í…ì²˜ëŠ” **â€œì§€ê¸ˆì˜ ìš”êµ¬ì‚¬í•­â€ì´ ì•„ë‹ˆë¼ â€œìš”êµ¬ì‚¬í•­ì´ ë³€í•  ë•Œì˜ ë¹„ìš©â€**ì„ ìµœì†Œí™”í•©ë‹ˆë‹¤.

### 6-1. ìˆ˜í‰ í™•ì¥ ì „ëµ

#### Zone ê¸°ë°˜ í™•ì¥

```
ì´ˆê¸° êµ¬ì„± (ë‹¨ì¼ Zone):
[ Game Server - Zone 1 ]
    â†“
[ 100 ~ 1000 CCU ]

í™•ì¥ 1ë‹¨ê³„ (Zone ë¶„ë¦¬):
[ Load Balancer ]
    â†“
[ Game Server - Zone 1 ] [ Game Server - Zone 2 ]
    â†“
[ 1000 ~ 5000 CCU ]

í™•ì¥ 2ë‹¨ê³„ (Zone Coordinator):
[ Load Balancer ]
    â†“
[ Zone Coordinator ]
    â†“
[ Zone 1 ] [ Zone 2 ] [ Zone 3 ] [ Zone N... ]
    â†“
[ 5000+ CCU ]
```

#### Session Migration

```
í”Œë ˆì´ì–´ê°€ Zone ì´ë™ ì‹œ:

1. í˜„ì¬ Zoneì—ì„œ í”Œë ˆì´ì–´ ìƒíƒœ ì§ë ¬í™”
2. Redisì— Migration Token ì €ì¥
3. í´ë¼ì´ì–¸íŠ¸ì—ê²Œ Zone ì´ë™ ì§€ì‹œ
4. ìƒˆ Zoneì—ì„œ Migration Tokenìœ¼ë¡œ ìƒíƒœ ë³µì›
5. ê¸°ì¡´ Zoneì—ì„œ í”Œë ˆì´ì–´ ì œê±°
```

#### í™•ì¥ íŠ¸ë¦¬ê±°

```
Zone ì¶”ê°€ ì¡°ê±´:
- Zone CPU > 80% ì§€ì† 5ë¶„
- GameLoop Tick > 100ms ì§€ì†
- CCU > Zone ì„¤ê³„ ìš©ëŸ‰ì˜ 80%

Zone í†µí•© ì¡°ê±´:
- ì „ì²´ CCU < ì „ì²´ ìš©ëŸ‰ì˜ 40%
- ë¹„ìš© ìµœì í™” í•„ìš”
- íŠ¹ì • ì‹œê°„ëŒ€ ìœ íœ´ Zone ë°œìƒ
```

### 6-2. ì´ë²¤íŠ¸ ì²˜ë¦¬ í™•ì¥

#### Kafka Consumer í™•ì¥

```
ì´ˆê¸°:
[ Kafka Topic ]
    â†“
[ Consumer (1 Instance) ]

í™•ì¥:
[ Kafka Topic (Partition 1-6) ]
    â†“
[ Consumer Group ]
    â”œâ”€â”€ Consumer Instance 1 (Partition 1-2)
    â”œâ”€â”€ Consumer Instance 2 (Partition 3-4)
    â””â”€â”€ Consumer Instance 3 (Partition 5-6)
```

**Auto-scaling ì¡°ê±´**:

- Consumer Lag > 10000
- ì²˜ë¦¬ ì§€ì—° > 5ì´ˆ
- CPU > 70%

### 6-3. ì‹ ê·œ ì„œë¹„ìŠ¤ ì¶”ê°€

#### ê¸°ì¡´ ì½”ë“œ ìˆ˜ì • ì—†ì´ í™•ì¥

```
[ ê²Œì„ ì„œë²„ ] (ìˆ˜ì • ì—†ìŒ)
    â†“ Domain Events
[ Kafka ]
    â†“
    â”œâ”€â”€ [ ê¸°ì¡´: Persistence Service ]
    â”œâ”€â”€ [ ì‹ ê·œ: Analytics Service ]
    â”œâ”€â”€ [ ì‹ ê·œ: Recommendation Service ]
    â””â”€â”€ [ ì‹ ê·œ: Anti-Cheat Service ]
```

**ì˜ˆì‹œ: ì¶”ì²œ ì‹œìŠ¤í…œ ì¶”ê°€**

```typescript
// ìƒˆë¡œìš´ Consumerë§Œ ì¶”ê°€
class RecommendationConsumer {
  async consume() {
    kafka.subscribe('game.events.player', async (event) => {
      if (event.type === 'PlayerMovedEvent') {
        await analyzePlayerBehavior(event);
      }
    });
  }
}
```

**ê¸°ì¡´ ì‹œìŠ¤í…œ ì˜í–¥**: ì „í˜€ ì—†ìŒ

### 6-4. ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸ í™•ì¥

#### B2C â†’ B2B ì „í™˜

```
í˜„ì¬ (B2C):
[ Game Server ]
    â†“
[ ìì‚¬ í”Œë«í¼ ]

í™•ì¥ (B2B):
[ Game Server ]
    â†“
[ Multi-tenant Platform ]
    â”œâ”€â”€ Tenant A
    â”œâ”€â”€ Tenant B
    â””â”€â”€ Tenant C
```

**í•„ìš”í•œ ë³€ê²½ì‚¬í•­**:

- Tenant ID ì¶”ê°€
- ë°ì´í„° ê²©ë¦¬
- API Key ê´€ë¦¬

**ê¸°ì¡´ ê²Œì„ ë¡œì§**: ìˆ˜ì • ë¶ˆí•„ìš”

#### White Label Solution

```
[ Core Game Server ]
    â†“
[ Event Stream ]
    â†“
    â”œâ”€â”€ [ Tenant A Platform ]
    â”œâ”€â”€ [ Tenant B Platform ]
    â””â”€â”€ [ Tenant C Platform ]
```

ê° Tenantê°€ ìì²´ ë¸Œëœë”©ê³¼ ìš´ì˜ ê°€ëŠ¥

#### API í”Œë«í¼ í™•ì¥

```
[ Game Server ]
    â†“
[ Public API Gateway ]
    â†“
    â”œâ”€â”€ REST API (ì™¸ë¶€ ê°œë°œì)
    â”œâ”€â”€ WebSocket (ì‹¤ì‹œê°„ ë°ì´í„°)
    â””â”€â”€ Webhook (ì´ë²¤íŠ¸ ì•Œë¦¼)
```

### 6-5. ì¥ë¥´ë³„ í™•ì¥ ì‹œë‚˜ë¦¬ì˜¤

|ê²Œì„ ì¥ë¥´       |í•„ìš”í•œ í™•ì¥                |ê¸°ì¡´ êµ¬ì¡° ì¬ì‚¬ìš©|
|------------|----------------------|---------|
|**ìºì£¼ì–¼ í¼ì¦**  |ë‹¨ì¼ Zone               |100%     |
|**ë§¤ì¹˜ ê¸°ë°˜ ê²Œì„**|Zoneë³„ ë§¤ì¹˜ ê·¸ë£¹           |95%      |
|**ë°°í‹€ë¡œì–„**    |ëŒ€ê·œëª¨ Zone + Spectator  |85%      |
|**MMORPG**  |Zone ë¶„ì‚° + Guild System|80%      |
|**MOBA**    |ì „ìš© Match Server       |75%      |

**í•µì‹¬**:

> **ê²Œì„ ì¥ë¥´ê°€ ë°”ë€Œì–´ë„ â€œì„œë²„ ê¶Œí•œ + ì´ë²¤íŠ¸ ë¶„ë¦¬â€ë¼ëŠ” ì›ì¹™ì€ ë™ì¼í•©ë‹ˆë‹¤.**

### 6-6. ê¸€ë¡œë²Œ í™•ì¥

#### ì§€ì—­ë³„ ì„œë²„ ë°°í¬

```
[ Global Load Balancer ]
    â†“
    â”œâ”€â”€ [ Asia Cluster ]
    â”œâ”€â”€ [ Europe Cluster ]
    â””â”€â”€ [ Americas Cluster ]

ê° Cluster:
- ë…ë¦½ Game Server
- ë…ë¦½ Platform Server
- ê³µí†µ Kafka (ì§€ì—­ ê°„ ë³µì œ)
- ê³µí†µ ê³„ì • DB
```

**Cross-region ê³ ë ¤ì‚¬í•­**:

- ê³„ì • ë°ì´í„°: ê¸€ë¡œë²Œ ë‹¨ì¼ DB
- ê²Œì„ ë°ì´í„°: ì§€ì—­ë³„ ë…ë¦½
- ì´ë²¤íŠ¸: Kafka Mirror Makerë¡œ ë³µì œ

### í™•ì¥ ë¹„ìš© ì˜ˆì¸¡

#### ì˜ˆìƒ ì¸í”„ë¼ ë¹„ìš© (AWS ê¸°ì¤€)

```
100 CCU:
- Game Server: t3.medium Ã— 1 ($30/ì›”)
- Platform Server: t3.small Ã— 1 ($15/ì›”)
- ì´: ~$45/ì›”

1,000 CCU:
- Game Server: c5.large Ã— 2 ($150/ì›”)
- Platform Server: t3.medium Ã— 2 ($60/ì›”)
- ì´: ~$210/ì›”

10,000 CCU:
- Game Server: c5.xlarge Ã— 10 ($1,500/ì›”)
- Platform Server: c5.large Ã— 4 ($300/ì›”)
- Kafka: MSK 3-broker ($500/ì›”)
- ì´: ~$2,300/ì›”
```

**ì„ í˜•ì  í™•ì¥ ë¹„ìš©**: CCU 10ë°° ì¦ê°€ ì‹œ ë¹„ìš© ì•½ 10ë°° ì¦ê°€

-----

## 7. ëŒ€ì•ˆ ë¹„êµì™€ ì„ íƒ ì´ìœ 

### ê³ ë ¤í–ˆì§€ë§Œ ì„ íƒí•˜ì§€ ì•Šì€ ëŒ€ì•ˆë“¤

#### ëŒ€ì•ˆ 1: ê²Œì„ ì„œë²„ ì§ì ‘ DB ì ‘ê·¼

```
[ Game Server ] â†’ [ Database ]
    â†“ ë™ê¸° CRUD
[ Response ]
```

**ì„ íƒí•˜ì§€ ì•Šì€ ì´ìœ **:

```
âŒ GameLoop Tickì´ DB ì‘ë‹µì„ ê¸°ë‹¤ë¦¼
âŒ DB ì¥ì•  ì‹œ ê²Œì„í”Œë ˆì´ ì¤‘ë‹¨
âŒ DB ë¶€í•˜ê°€ ê³§ ê²Œì„ ì„œë²„ ë¶€í•˜
âŒ íŠ¸ëœì­ì…˜ ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ë³µì¡
```

**íŠ¸ë ˆì´ë“œì˜¤í”„ ë¶„ì„**:

|í•­ëª©     |ì§ì ‘ DB ì ‘ê·¼  |ì´ë²¤íŠ¸ ê¸°ë°˜    |
|-------|----------|----------|
|êµ¬í˜„ ë³µì¡ë„ |â­â­ (ë‚®ìŒ)   |â­â­â­â­ (ë†’ìŒ) |
|ì‹¤ì‹œê°„ ì•ˆì •ì„±|â­â­ (ë‚®ìŒ)   |â­â­â­â­â­ (ë†’ìŒ)|
|ì¥ì•  ê²©ë¦¬  |â­ (ë§¤ìš° ë‚®ìŒ) |â­â­â­â­â­ (ë†’ìŒ)|
|ë°ì´í„° ì¼ê´€ì„±|â­â­â­â­â­ (ë†’ìŒ)|â­â­â­ (ì¤‘ê°„)  |

**ê²°ë¡ **: ì‹¤ì‹œê°„ ì•ˆì •ì„±ê³¼ ì¥ì•  ê²©ë¦¬ë¥¼ ì„ íƒ

#### ëŒ€ì•ˆ 2: ëª¨ë“  ìš”ì²­ ë™ê¸° ì²˜ë¦¬

```
Client â†’ Server â†’ Process â†’ DB â†’ Response â†’ Client
(ëª¨ë“  ë‹¨ê³„ê°€ ë™ê¸°ì ìœ¼ë¡œ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°)
```

**ì„ íƒí•˜ì§€ ì•Šì€ ì´ìœ **:

```
âŒ ì‚¬ìš©ì ì¦ê°€ ì‹œ ì„ í˜•ì ìœ¼ë¡œ ëŠë ¤ì§
âŒ íŠ¹ì • ìš”ì²­ì´ ëŠë¦¬ë©´ ì „ì²´ ì‹œìŠ¤í…œ ì§€ì—°
âŒ ì¥ì•  ì „íŒŒ ë¶ˆê°€í”¼
âŒ í™•ì¥ ë¹„ìš© ê¸‰ì¦
```

**ì‹¤ì œ ì‹œë‚˜ë¦¬ì˜¤**:

```
100ëª… ì ‘ì† ì‹œ:
- í‰ê·  ì‘ë‹µ ì‹œê°„: 50ms
- í—ˆìš© ê°€ëŠ¥

1000ëª… ì ‘ì† ì‹œ:
- í‰ê·  ì‘ë‹µ ì‹œê°„: 500ms
- ì²´ê° ì§€ì—° ë°œìƒ

10000ëª… ì ‘ì† ì‹œ:
- í‰ê·  ì‘ë‹µ ì‹œê°„: 5000ms
- ê²Œì„ ë¶ˆê°€ëŠ¥
```

**ì´ë²¤íŠ¸ ê¸°ë°˜ êµ¬ì¡°**:

```
íŒì •ì€ ì¦‰ì‹œ (50ms ê³ ì •)
ê¸°ë¡ì€ ë‚˜ì¤‘ì— (ë¹„ë™ê¸°)
â†’ ì‚¬ìš©ì ìˆ˜ì™€ ë¬´ê´€í•˜ê²Œ ì•ˆì •ì 
```

#### ëŒ€ì•ˆ 3: ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ (MSA)

```
[ API Gateway ]
    â†“
[ Auth Service ] [ User Service ] [ Match Service ]
[ Inventory Service ] [ Payment Service ] ...
```

**ì„ íƒí•˜ì§€ ì•Šì€ ì´ìœ **:

```
âŒ ì´ˆê¸° ë³µì¡ë„ ê³¼ë‹¤ (Over-engineering)
âŒ ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì˜¤ë²„í—¤ë“œ
âŒ ë¶„ì‚° íŠ¸ëœì­ì…˜ ë³µì¡ë„
âŒ ìš´ì˜ ë¶€ë‹´ (ì„œë¹„ìŠ¤ ìˆ˜ Ã— N)
âŒ ê°œë°œì ì¸ì§€ ë¶€í•˜ ì¦ê°€
```

**ì–¸ì œ MSAê°€ í•„ìš”í•œê°€?**

```
ì¡°ì§ì´ í¬ê³ :
- íŒ€ì´ 10ê°œ ì´ìƒ
- ë…ë¦½ ë°°í¬ í•„ìš”

ê¸°ëŠ¥ì´ ëª…í™•íˆ ë¶„ë¦¬ë˜ê³ :
- ë„ë©”ì¸ ê²½ê³„ê°€ í™•ì‹¤
- ë³€ê²½ ì£¼ê¸°ê°€ ë‹¤ë¦„

ìš´ì˜ ì—­ëŸ‰ì´ ì¶©ë¶„í•  ë•Œ:
- DevOps íŒ€ ì¡´ì¬
- ëª¨ë‹ˆí„°ë§ ì¸í”„ë¼ êµ¬ì¶•
```

**í˜„ì¬ ì„ íƒ**: Modular Monolith

```
[ Game Server ] (Monolith)
    â”œâ”€â”€ Network Module
    â”œâ”€â”€ Domain Module
    â””â”€â”€ Event Module

[ Platform Server ] (Monolith)
    â”œâ”€â”€ Kafka Consumer
    â”œâ”€â”€ API Module
    â””â”€â”€ Persistence Module
```

**ì¥ì **:

- ë‹¨ìˆœí•œ ë°°í¬
- ë‚®ì€ ìš´ì˜ ë³µì¡ë„
- í•„ìš” ì‹œ ì‰½ê²Œ ë¶„ë¦¬ ê°€ëŠ¥

#### ëŒ€ì•ˆ 4: NoSQL Only (MongoDB/Redisë§Œ ì‚¬ìš©)

**ì„ íƒí•˜ì§€ ì•Šì€ ì´ìœ **:

```
âŒ ì •í˜• ë°ì´í„° ì²˜ë¦¬ ì–´ë ¤ì›€ (ê³„ì •, ê±°ë˜)
âŒ íŠ¸ëœì­ì…˜ ì œì•½
âŒ ë³µì¡í•œ ì¿¼ë¦¬ ì„±ëŠ¥
âŒ ìš´ì˜ ë°ì´í„° ë¶„ì„ ë¶ˆí¸
```

**ì„ íƒí•œ êµ¬ì¡°**: Polyglot Persistence

```
Redis: ìºì‹œ + ìŠ¤ëƒ…ìƒ·
MongoDB: ë¹„ì •í˜• ë°ì´í„° + ìŠ¤ëƒ…ìƒ·
MySQL: ì •í˜• ë°ì´í„° + íŠ¸ëœì­ì…˜
```

**ê°ìì˜ ê°•ì ì„ í™œìš©**

#### ëŒ€ì•ˆ 5: UDP í”„ë¡œí† ì½œ

**ì„ íƒí•˜ì§€ ì•Šì€ ì´ìœ **:

```
âœ“ UDPê°€ ë” ë¹ ë¦„ (ì‚¬ì‹¤)
âœ“ íŒ¨í‚· ì†ì‹¤ í—ˆìš© ê°€ëŠ¥ (ì‚¬ì‹¤)

ê·¸ëŸ¬ë‚˜:
âŒ êµ¬í˜„ ë³µì¡ë„ ì¦ê°€
âŒ í¬íŠ¸í´ë¦¬ì˜¤ ëª©ì ìƒ TCPë¡œ ì¶©ë¶„
âŒ ì„œë²„ ê¶Œí•œ ëª¨ë¸ ì¦ëª…ì— UDP ë¶ˆí•„ìš”
```

**ì‹¤ë¬´ íŒë‹¨**:

- FPS, ë ˆì´ì‹±: UDP í•„ìš”
- í„´ì œ, í¼ì¦, MOBA: TCP ì¶©ë¶„
- í¬íŠ¸í´ë¦¬ì˜¤: **ì•„í‚¤í…ì²˜ ì¦ëª…ì´ ëª©í‘œ**

### ì„ íƒì˜ ê¸°ì¤€

ì´ ëª¨ë“  ì„ íƒì€ ë‹¤ìŒ ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨í–ˆìŠµë‹ˆë‹¤:

```
1. ë³µì¡ë„ vs ì–»ëŠ” ê°€ì¹˜
2. ì´ˆê¸° ë¹„ìš© vs í™•ì¥ ë¹„ìš©
3. ìš´ì˜ ë‚œì´ë„
4. ì¥ì•  ê²©ë¦¬ ê°€ëŠ¥ì„±
5. íŒ€ í¬ê¸°ì™€ ì—­ëŸ‰
```

**ì´ ì„¤ê³„ëŠ” ì •ë‹µì„ ë§íˆëŠ” êµ¬ì¡°ê°€ ì•„ë‹ˆë¼, ìƒí™©ì— ë§ëŠ” íŒë‹¨ì„ ì„¤ëª…í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.**

### ì˜ì‚¬ê²°ì • í”„ë ˆì„ì›Œí¬

```
ìƒˆë¡œìš´ ê¸°ìˆ /íŒ¨í„´ì„ ë„ì…í•  ë•Œ:

ì§ˆë¬¸ 1: ì´ê²ƒ ì—†ì´ëŠ” ëª©í‘œ ë‹¬ì„±ì´ ë¶ˆê°€ëŠ¥í•œê°€?
â†’ Noë©´ ë„ì…í•˜ì§€ ì•ŠìŒ

ì§ˆë¬¸ 2: ìš´ì˜ ë³µì¡ë„ ì¦ê°€ë¥¼ ê°ë‹¹í•  ìˆ˜ ìˆëŠ”ê°€?
â†’ Noë©´ ë„ì…í•˜ì§€ ì•ŠìŒ

ì§ˆë¬¸ 3: íŒ€ì´ ì´í•´í•˜ê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•œê°€?
â†’ Noë©´ ë„ì…í•˜ì§€ ì•ŠìŒ

ì§ˆë¬¸ 4: ë‚˜ì¤‘ì— ì¶”ê°€í•´ë„ ëŠ¦ì§€ ì•Šì€ê°€?
â†’ Yesë©´ ì§€ê¸ˆ ë„ì…í•˜ì§€ ì•ŠìŒ
```

**ì›ì¹™**:

> **â€œì§€ê¸ˆ í•„ìš”í•˜ì§€ ì•Šìœ¼ë©´, ì§€ê¸ˆ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.â€**

-----

## 8. ë‚˜ì˜ ì±…ì„ ë²”ìœ„

ì´ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ ì œê°€ ì±…ì„ì§„ ì˜ì—­ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

```
âœ“ ì „ì²´ ì•„í‚¤í…ì²˜ êµ¬ì¡° ì„¤ê³„
âœ“ ì±…ì„ ë¶„ë¦¬ ê¸°ì¤€ ì •ì˜
âœ“ ì‹¤ì‹œê°„ ì²˜ë¦¬ ëª¨ë¸ ê²°ì •
âœ“ ì´ë²¤íŠ¸ íë¦„ê³¼ ë°ì´í„° ì „ëµ ì„¤ê³„
âœ“ ìš´ì˜ê³¼ í™•ì¥ì„ ê³ ë ¤í•œ êµ¬ì¡° íŒë‹¨
```

**êµ¬í˜„ ì—¬ë¶€ì™€ ë¬´ê´€í•˜ê²Œ â€œì´ êµ¬ì¡°ê°€ ì™œ ì´ë ‡ê²Œ ìƒê²¼ëŠ”ê°€â€ì— ëŒ€í•œ ì±…ì„ì„ ì§‘ë‹ˆë‹¤.**

-----

## 9. í•œ ë¬¸ì¥ ìš”ì•½

> **ì´ í¬íŠ¸í´ë¦¬ì˜¤ëŠ” ë‚´ê°€ ì–´ë–¤ ê¸°ìˆ ì„ ì“°ëŠ” ì‚¬ëŒì´ ì•„ë‹ˆë¼, ì–´ë–¤ êµ¬ì¡°ë¥¼ ì¡°ì§ì— ë‚¨ê¸°ëŠ” ì‚¬ëŒì¸ì§€ë¥¼ ì„¤ëª…í•˜ê¸° ìœ„í•œ ì„¤ê³„ ì‚¬ë¡€ì…ë‹ˆë‹¤.**

-----

## ğŸ›  ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ

### ê²Œì„ ì„œë²„

- C#
- TCP/IP
- MessagePack
- Redis
- MongoDB
- Kafka

### í”Œë«í¼ ì„œë²„

- TypeScript
- bun.js
- ElysiaJS
- Kafka
- MySQL
- Drizzle ORM
- REST API
- WebSocket

### ìš´ì˜ ëŒ€ì‹œë³´ë“œ

- React
- TypeScript
- Zustand
- Custom Hooks

-----

## ğŸ“š ìƒì„¸ ë¬¸ì„œ

ì´ READMEëŠ” ì„¤ê³„ì˜ í•µì‹¬ ê°œë…ê³¼ íŒë‹¨ì„ ìš”ì•½í•œ ê²ƒì…ë‹ˆë‹¤.

ìƒì„¸í•œ ê¸°ìˆ  ë‚´ìš©ì€ ë‹¤ìŒ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ì„¸ìš”:

- [ìƒì„¸ ì•„í‚¤í…ì²˜ ë¬¸ì„œ](docs/architecture-detail.md)
- [ì„¤ê³„ ê²°ì • ê³¼ì •](docs/design-decisions.md)
- [ìš´ì˜ ê°€ì´ë“œ](docs/operational-guide.md)
- [êµ¬í˜„ ë¡œë“œë§µ](docs/implementation-roadmap.md) â­
- [API ëª…ì„¸](docs/api-reference.md)
- [ë‹¤ì´ì–´ê·¸ë¨](docs/diagrams/)

-----

## ğŸ—ºï¸ êµ¬í˜„ ë¡œë“œë§µ

### ì „ì²´ ëª©í‘œ ì •ì˜

ì´ í¬íŠ¸í´ë¦¬ì˜¤ì˜ êµ¬í˜„ ëª©í‘œëŠ” ë‹¤ìŒ í•œ ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½ë©ë‹ˆë‹¤:

> **â€œì‹¤ì‹œê°„ íŒì •ì€ ë©”ëª¨ë¦¬ì—ì„œ ëë‚˜ê³ , ê¸°ë¡ê³¼ ë³µêµ¬ëŠ” ë¹„ë™ê¸°ë¡œ í¡ìˆ˜ë˜ëŠ” êµ¬ì¡°ë¥¼ ì‹¤ì œë¡œ ì¦ëª…í•œë‹¤.â€**

### ì´ í¬íŠ¸í´ë¦¬ì˜¤ëŠ”

```
âœ— ëŒ€ê·œëª¨ MMO ì™„ì„± êµ¬í˜„ì„ ëª©í‘œë¡œ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
âœ— í™”ë ¤í•œ í´ë¼ì´ì–¸íŠ¸ë‚˜ ì½˜í…ì¸  ë³¼ë¥¨ì„ ì¶”êµ¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
âœ— ëª¨ë“  ê¸°ëŠ¥ì„ ë‹¤ ë§Œë“œëŠ” ê²ƒì„ ì§€ì–‘í•©ë‹ˆë‹¤

âœ“ ìš´ì˜ ê°€ëŠ¥í•œ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œì˜ í•µì‹¬ êµ¬ì¡°ë§Œì„
âœ“ ìµœì†Œ êµ¬í˜„ìœ¼ë¡œ ì¦ëª…í•˜ëŠ” ê²ƒì´ ëª©ì ì…ë‹ˆë‹¤
```

### ì „ì²´ ë¡œë“œë§µ ê°œìš”

```
Phase 0. ì„¤ê³„ í™•ì • (ë¬¸ì„œ)              [ì™„ë£Œ]
Phase 1. MVP êµ¬í˜„ (í•µì‹¬ íë¦„)          [ì§„í–‰ ì˜ˆì •]
Phase 2. ì´ë²¤íŠ¸ ì‹ ë¢°ì„±                  [ê³„íš]
Phase 3. Hot/Cold Snapshot             [ê³„íš]
Phase 4. í¬íŠ¸í´ë¦¬ì˜¤ ì •ë¦¬                [ê³„íš]
```

-----

### Phase 0. ì„¤ê³„ í™•ì • âœ… ì™„ë£Œ

**ëª©ì **: â€œì´ ì‹œìŠ¤í…œì€ ì´ë ‡ê²Œ ë§Œë“¤ê¸°ë¡œ ê²°ì •í–ˆë‹¤â€ëŠ” ê¸°ì¤€ì„ ê³ ì •

**ì‚°ì¶œë¬¼**:

- ìµœì¢… ì•„í‚¤í…ì²˜ ì„¤ê³„ ë¬¸ì„œ
- ì„¤ê³„ ì›ì¹™ ëª…ë¬¸í™”

**í™•ì •ëœ ì„¤ê³„ ì›ì¹™**:

```
âœ“ Server-authoritative êµ¬ì¡°
âœ“ Packet â†’ Command â†’ Domain â†’ Event íë¦„
âœ“ ì‹¤ì‹œê°„ ì²˜ë¦¬ì™€ ë¹„ë™ê¸° ê¸°ë¡ì˜ ëª…í™•í•œ ë¶„ë¦¬
âœ“ ê²Œì„ ì„œë²„ëŠ” DB ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•ŠëŠ”ë‹¤
```

**ì´ ë‹¨ê³„ëŠ” ì´í›„ ëª¨ë“  êµ¬í˜„ íŒë‹¨ì˜ ê¸°ì¤€ì„ ì´ ë©ë‹ˆë‹¤.**

**ì†Œìš” ì‹œê°„**: 1~2ì¼

-----

### Phase 1. MVP êµ¬í˜„ (í•„ìˆ˜) ğŸ”„ ì§„í–‰ ì˜ˆì •

**ëª©ì **: ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ì™€ ì´ë²¤íŠ¸ ê¸°ë°˜ í”Œë«í¼ ì„œë²„ê°€ ì‹¤ì œë¡œ ë¶„ë¦¬ë˜ì–´ ë™ì‘í•¨ì„ ì¦ëª…

#### 1-1. ê²Œì„ ì„œë²„ (C# TCP/IP)

**êµ¬í˜„ ë²”ìœ„ (ìµœì†Œ)**:

```
âœ“ TCP/IP ì†Œì¼“ ì„œë²„
âœ“ Session ê´€ë¦¬
âœ“ Packet â†’ Command ë³€í™˜
âœ“ ë‹¨ì¼ GameLoop Tick
âœ“ In-memory Player State
âœ“ Domain Event ìƒì„±
âœ“ Kafka Producer ì—°ë™
```

**ë°˜ë“œì‹œ í¬í•¨í•  ìµœì†Œ ê¸°ëŠ¥**:

```csharp
// 1. í”Œë ˆì´ì–´ ì ‘ì†
public void OnPlayerConnect(Session session)
{
    var player = new Player(session.PlayerId);
    _activePlayers.Add(player);
    
    PublishEvent(new PlayerConnectedEvent
    {
        PlayerId = player.Id,
        ConnectedAt = DateTime.UtcNow
    });
}

// 2. ê°„ë‹¨í•œ ìƒíƒœ ë³€ê²½ (ìœ„ì¹˜ ë³€ê²½)
public void ProcessMoveCommand(MoveCommand cmd)
{
    var player = GetPlayer(cmd.PlayerId);
    
    // Validation
    if (!ValidateMove(cmd))
    {
        SendRejection(cmd.PlayerId, "Invalid move");
        return;
    }
    
    // State Change (ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ)
    var oldPosition = player.Position;
    player.Position = cmd.NewPosition;
    
    // Domain Event ë°œí–‰ (ë¹„ë™ê¸°)
    PublishEvent(new PlayerMovedEvent
    {
        PlayerId = player.Id,
        FromPosition = oldPosition,
        ToPosition = cmd.NewPosition,
        OccurredAt = DateTime.UtcNow
    });
    
    // ì¦‰ì‹œ ì‘ë‹µ (Kafka ì‘ë‹µ ëŒ€ê¸° X)
    SendResponse(cmd.PlayerId, player.Position);
}
```

**ì˜ë„ì ìœ¼ë¡œ êµ¬í˜„í•˜ì§€ ì•ŠëŠ” ê²ƒ**:

```
âœ— ì „íˆ¬ ì‹œìŠ¤í…œ
âœ— MMO ì½˜í…ì¸ 
âœ— ë³µì¡í•œ ë™ê¸°í™” ë¡œì§
âœ— í´ë¼ì´ì–¸íŠ¸ ì˜ˆì¸¡
âœ— ì¸ë²¤í† ë¦¬ ì‹œìŠ¤í…œ
```

#### 1-2. í”Œë«í¼ ì„œë²„ (TypeScript / bun.js / Elysia)

**êµ¬í˜„ ë²”ìœ„**:

```typescript
// Kafka Consumer
class EventConsumer {
  async start() {
    await this.kafka.subscribe('game.events.player');
    
    await this.kafka.consume(async (event) => {
      switch (event.type) {
        case 'PlayerConnectedEvent':
          await this.handlePlayerConnected(event);
          break;
        case 'PlayerMovedEvent':
          await this.handlePlayerMoved(event);
          break;
      }
    });
  }
  
  private async handlePlayerMoved(event: PlayerMovedEvent) {
    // ë‹¨ìˆœí•œ DB ì €ì¥ (MySQL ë˜ëŠ” MongoDB)
    await this.db.insert('player_movements', {
      player_id: event.playerId,
      from_position: event.fromPosition,
      to_position: event.toPosition,
      occurred_at: event.occurredAt
    });
  }
}
```

**í•µì‹¬ í¬ì¸íŠ¸**:

```
âœ“ í”Œë«í¼ ì„œë²„ëŠ” ì˜¤ì§ Kafka ì´ë²¤íŠ¸ë§Œ ì†Œë¹„
âœ“ ì‹¤ì‹œê°„ ë¡œì§ì— ì ˆëŒ€ ê°œì…í•˜ì§€ ì•ŠìŒ
âœ“ ê²Œì„ ì„œë²„ì™€ ì§ì ‘ í†µì‹ í•˜ì§€ ì•ŠìŒ
```

#### 1-3. ìœ ë‹ˆí‹° í´ë¼ì´ì–¸íŠ¸ (ì¦ëª…ìš© í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸)

**êµ¬í˜„ ë²”ìœ„**:

```csharp
public class PlayerController : MonoBehaviour
{
    private NetworkClient _client;
    
    void Update()
    {
        // ì…ë ¥ ê°ì§€
        if (Input.GetKeyDown(KeyCode.W))
        {
            var newPos = transform.position + Vector3.forward;
            
            // ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ë³€ê²½í•˜ì§€ ì•ŠìŒ!
            // ì„œë²„ì— ìš”ì²­ë§Œ ì „ì†¡
            _client.SendMoveRequest(newPos);
            
            Debug.Log($"[Client] Move requested: {newPos}");
        }
    }
    
    // ì„œë²„ë¡œë¶€í„° ìŠ¹ì¸ëœ ìœ„ì¹˜ë§Œ ë°˜ì˜
    public void OnServerMoveConfirmed(Vector3 serverPosition)
    {
        transform.position = serverPosition;
        Debug.Log($"[Client] Move confirmed: {serverPosition}");
    }
}
```

**ì‹œê°ì  ê¸°ì¤€**:

```
âœ“ íë¸Œ í•˜ë‚˜ë©´ ì¶©ë¶„
âœ“ ëšëš ì´ë™í•´ë„ ë¬¸ì œ ì—†ìŒ
âœ“ ë¶€ë“œëŸ¬ìš´ ë³´ê°„(Lerp)ì€ ì„ íƒ ì‚¬í•­
```

**README í•„ìˆ˜ ë¬¸êµ¬**:

```markdown
## Client Architecture Note

**This Unity client intentionally avoids client-side authority.**

All state changes are applied only after server confirmation,
to demonstrate a strictly server-authoritative architecture.
```

#### MVP ë‹¨ê³„ì—ì„œ ì¦ëª…ë˜ëŠ” ê²ƒ

```
âœ“ ì‹¤ì‹œê°„ íŒì •ê³¼ ê¸°ë¡ì˜ ë¶„ë¦¬ êµ¬ì¡°
âœ“ ì„œë¡œ ë‹¤ë¥¸ ì–¸ì–´(C#, TypeScript) ê°„ ì´ë²¤íŠ¸ ì—°ê³„
âœ“ ê²Œì„ ì„œë²„ëŠ” ê°€ë³ê³ , í”Œë«í¼ ì„œë²„ê°€ ë¬´ê±°ìš´ ì±…ì„ì„ ê°€ì§„ë‹¤ëŠ” êµ¬ì¡°ì  íŒë‹¨
```

**ì´ ë‹¨ê³„ê¹Œì§€ê°€ MVPì´ë©°, ì—¬ê¸°ê¹Œì§€ë§Œìœ¼ë¡œë„ í¬íŠ¸í´ë¦¬ì˜¤ë¡œ ì¶©ë¶„í•œ ì„¤ë“ë ¥ì„ ê°€ì§‘ë‹ˆë‹¤.**

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 1~2ì£¼

-----

### Phase 2. ì´ë²¤íŠ¸ ì‹ ë¢°ì„± ğŸ“‹ ê³„íš

**ëª©ì **: Kafka ê¸°ë°˜ êµ¬ì¡°ì—ì„œ ë°˜ë“œì‹œ ì§ˆë¬¸ë°›ê²Œ ë˜ëŠ” â€œì´ë²¤íŠ¸ ì‹ ë¢°ì„±â€ì— ëŒ€í•œ ë‹µì„ ì œì‹œ

#### 2-1. Domain Event í™•ì¥

**ì´ë²¤íŠ¸ ë©”íƒ€ë°ì´í„° ì¶”ê°€**:

```csharp
public abstract class DomainEvent
{
    public string EventId { get; set; }        // UUID
    public string AggregateId { get; set; }    // playerId ë˜ëŠ” entityId
    public DateTime OccurredAt { get; set; }   // ë°œìƒ ì‹œê°
    public int Version { get; set; }           // ì´ë²¤íŠ¸ ë²„ì „
}

public class PlayerMovedEvent : DomainEvent
{
    public string PlayerId { get; set; }
    public Vector3 FromPosition { get; set; }
    public Vector3 ToPosition { get; set; }
}
```

#### 2-2. í”Œë«í¼ ì„œë²„ ì²˜ë¦¬ ì „ëµ

**Idempotency êµ¬í˜„**:

```typescript
class IdempotentEventHandler {
  async handle(event: DomainEvent) {
    const key = `event:${event.eventId}`;
    
    // ì´ë¯¸ ì²˜ë¦¬ëœ ì´ë²¤íŠ¸ì¸ì§€ í™•ì¸
    const processed = await this.redis.get(key);
    if (processed) {
      logger.info(`Event already processed: ${event.eventId}`);
      return;
    }
    
    try {
      // ì´ë²¤íŠ¸ ì²˜ë¦¬
      await this.processEvent(event);
      
      // ì²˜ë¦¬ ì™„ë£Œ ê¸°ë¡ (TTL: 1ì‹œê°„)
      await this.redis.setex(key, 3600, 'processed');
    } catch (error) {
      // ì‹¤íŒ¨ ì‹œ DLQë¡œ ì „ì†¡
      await this.sendToDLQ(event, error);
    }
  }
}
```

#### 2-3. DLQ (Dead Letter Queue)

```
ì •ìƒ íë¦„:
[ Game Server ] â†’ [ Kafka ] â†’ [ Platform Server ] â†’ [ DB ]

ì‹¤íŒ¨ íë¦„:
[ Game Server ] â†’ [ Kafka ] â†’ [ Platform Server ]
                                     â†“ (ì‹¤íŒ¨)
                                [ DLQ Topic ]
                                     â†“ (ìˆ˜ë™ ì²˜ë¦¬)
                                [ Admin Review ]
```

**í•µì‹¬ ì›ì¹™**:

```
âœ“ DB ì €ì¥ ì‹¤íŒ¨ ì‹œ ì¦‰ì‹œ ì¬ì‹œë„í•˜ì§€ ì•ŠìŒ
âœ“ ê²Œì„ ì„œë²„ëŠ” ì‹¤íŒ¨ ì—¬ë¶€ë¥¼ ì•Œì§€ ëª»í•¨
âœ“ ì‹¤íŒ¨ ì²˜ë¦¬ëŠ” ì „ì ìœ¼ë¡œ ìš´ì˜ ì˜ì—­ì˜ ì±…ì„
```

#### ì´ ë‹¨ê³„ì—ì„œ ì¦ëª…ë˜ëŠ” ê²ƒ

```
âœ“ ì´ë²¤íŠ¸ ìœ ì‹¤ê³¼ ì¤‘ë³µì„ ì •ìƒì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ì„¤ê³„í•¨
âœ“ ì¥ì• ê°€ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œìœ¼ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ ì°¨ë‹¨í•¨
âœ“ ìš´ì˜ê³¼ ì‹¤ì‹œê°„ ë¡œì§ì˜ ì±…ì„ ë¶„ë¦¬ê°€ ëª…í™•í•¨
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 3~5ì¼

-----

### Phase 3. Hot/Cold Snapshot ğŸ’¾ ê³„íš

**ëª©ì **: ê²Œì„ ì„œë²„ ì¥ì•  ì‹œì—ë„ ì„œë¹„ìŠ¤ê°€ ë³µêµ¬ ê°€ëŠ¥í•¨ì„ êµ¬ì¡°ì ìœ¼ë¡œ ì¦ëª…

#### 3-1. Hot Snapshot (Redis)

```csharp
public class RedisSnapshotService
{
    private readonly IRedisClient _redis;
    
    // ì£¼ê¸°ì ìœ¼ë¡œ Player State ì €ì¥ (5~10ì´ˆ)
    public async Task SaveHotSnapshot(Player player)
    {
        var key = $"snapshot:player:{player.Id}";
        
        // MessagePackìœ¼ë¡œ binary ì§ë ¬í™”
        var snapshot = MessagePackSerializer.Serialize(player);
        
        // TTL: 5ë¶„
        await _redis.SetAsync(key, snapshot, TimeSpan.FromMinutes(5));
    }
    
    // ë³µêµ¬
    public async Task<Player> LoadHotSnapshot(string playerId)
    {
        var key = $"snapshot:player:{playerId}";
        var snapshot = await _redis.GetAsync<byte[]>(key);
        
        if (snapshot == null)
            return null;
        
        return MessagePackSerializer.Deserialize<Player>(snapshot);
    }
}
```

**íŠ¹ì§•**:

```
âœ“ ì •í™•ì„±ë³´ë‹¤ ì†ë„ë¥¼ ìš°ì„ 
âœ“ TTLë¡œ ìë™ ì •ë¦¬
âœ“ ìˆ˜ì´ˆ ë‚´ ë³µêµ¬ ê°€ëŠ¥
```

#### 3-2. Cold Snapshot (MongoDB)

```csharp
public class MongoSnapshotService
{
    // ì„œë²„ ì¢…ë£Œ ë˜ëŠ” ì¥ì•  ì‹œ
    public async Task SaveColdSnapshot(Zone zone)
    {
        var snapshot = new ZoneSnapshot
        {
            ZoneId = zone.Id,
            Timestamp = DateTime.UtcNow,
            Players = zone.Players.Select(p => p.Serialize()).ToList(),
            Checksum = CalculateChecksum(zone)
        };
        
        await _mongo.InsertOneAsync(snapshot);
    }
    
    // ë³µêµ¬
    public async Task<Zone> LoadColdSnapshot(string zoneId)
    {
        var snapshot = await _mongo
            .Find(s => s.ZoneId == zoneId)
            .SortByDescending(s => s.Timestamp)
            .FirstOrDefaultAsync();
        
        return snapshot?.Deserialize();
    }
}
```

**íŠ¹ì§•**:

```
âœ“ ì¥ê¸° ë³´ê´€
âœ“ ì •í•©ì„± ê²€ì¦ (Checksum)
âœ“ ì ê²€ ë° ë¶„ì„ ìš©ë„
```

#### 3-3. ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤

```
[ ê²Œì„ ì„œë²„ í¬ë˜ì‹œ ]
    â†“
[ ë³µêµ¬ í”„ë¡œì„¸ìŠ¤ ì‹œì‘ ]
    â†“
1. Redis Snapshot ì¡´ì¬?
   Yes â†’ ì¦‰ì‹œ ë³µêµ¬ (ìˆ˜ì´ˆ)
   No â†’ 2ë‹¨ê³„
    â†“
2. MongoDB Snapshot ì¡´ì¬?
   Yes â†’ ë³µêµ¬ (ìˆ˜ë¶„)
   No â†’ 3ë‹¨ê³„
    â†“
3. ì´ˆê¸° ìƒíƒœë¡œ ì‹œì‘
   (Kafka Event Replayë¡œ ë³´ì • ê°€ëŠ¥)
```

**ì´ ë‹¨ê³„ì—ì„œëŠ” êµ¬í˜„ë³´ë‹¤ â€œì„¤ëª…ê³¼ íŒë‹¨â€ì´ ë” ì¤‘ìš”í•©ë‹ˆë‹¤.**

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 4~7ì¼

-----

### Phase 4. í¬íŠ¸í´ë¦¬ì˜¤ ì •ë¦¬ ğŸ“ ê³„íš

#### ë°˜ë“œì‹œ ëª…ì‹œí•´ì•¼ í•  ê²ƒ

```markdown
## êµ¬í˜„ ë²”ìœ„

### âœ… êµ¬í˜„ ì™„ë£Œ
- Game Server (C#): TCP, Session, GameLoop, Domain Event
- Platform Server (TypeScript): Kafka Consumer, DB Persistence
- Unity Client: Server-authoritative ì¦ëª…ìš© í…ŒìŠ¤íŠ¸ í´ë¼ì´ì–¸íŠ¸
- Event Idempotency & DLQ
- Hot/Cold Snapshot

### ğŸ“‹ ì˜ë„ì ìœ¼ë¡œ êµ¬í˜„í•˜ì§€ ì•Šì€ ê²ƒ
- ì „íˆ¬ ì‹œìŠ¤í…œ
- ë³µì¡í•œ ê²Œì„ ì½˜í…ì¸ 
- í´ë¼ì´ì–¸íŠ¸ ì˜ˆì¸¡
- ì™„ì „í•œ ë§¤ì¹˜ë©”ì´í‚¹
- ìš´ì˜ ëŒ€ì‹œë³´ë“œ (ì„¤ê³„ë§Œ)

### ğŸ¯ ì™œ ì—¬ê¸°ì„œ ë©ˆì·„ëŠ”ê°€?

**ì´ í¬íŠ¸í´ë¦¬ì˜¤ëŠ” ëŒ€ê·œëª¨ MMO êµ¬í˜„ì„ ëª©í‘œë¡œ í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.**

ì‹¤ì‹œê°„ íŒì •, ì´ë²¤íŠ¸ ê¸°ë°˜ í™•ì¥, ì¥ì•  í¡ìˆ˜ êµ¬ì¡°ë¥¼ ì¦ëª…í•˜ëŠ” ë° 
í•„ìš”í•œ ìµœì†Œ êµ¬í˜„ê¹Œì§€ë§Œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

ì¶”ê°€ ê¸°ëŠ¥ì€ "ë” ë§Œë“¤ ìˆ˜ ìˆë‹¤"ê°€ ì•„ë‹ˆë¼ 
"ì–¸ì œ ë©ˆì¶°ì•¼ í•˜ëŠ”ì§€ ì•ˆë‹¤"ë¥¼ ì¦ëª…í•˜ê¸° ìœ„í•´ ì˜ë„ì ìœ¼ë¡œ ì œì™¸í–ˆìŠµë‹ˆë‹¤.
```

**ì˜ˆìƒ ì†Œìš” ì‹œê°„**: 2~3ì¼

-----

### ì „ì²´ íƒ€ì„ë¼ì¸ ìš”ì•½

|Phase  |ë‚´ìš©      |ì˜ˆìƒ ì†Œìš”|ìƒíƒœ     |
|-------|--------|-----|-------|
|Phase 0|ì„¤ê³„ í™•ì •   |1~2ì¼ |âœ… ì™„ë£Œ   |
|Phase 1|MVP êµ¬í˜„  |1~2ì£¼ |ğŸ”„ ì§„í–‰ ì˜ˆì •|
|Phase 2|ì´ë²¤íŠ¸ ì‹ ë¢°ì„± |3~5ì¼ |ğŸ“‹ ê³„íš   |
|Phase 3|Snapshot|4~7ì¼ |ğŸ“‹ ê³„íš   |
|Phase 4|ë¬¸ì„œ ì •ë¦¬   |2~3ì¼ |ğŸ“‹ ê³„íš   |

**ì´ ì˜ˆìƒ ê¸°ê°„**: ì•½ 3~4ì£¼

-----

### ê°€ì¥ ì¤‘ìš”í•œ ê²°ë¡ 

> **ì´ ë¡œë“œë§µì˜ ëª©ì ì€ â€œì™„ì„±â€ì´ ì•„ë‹™ë‹ˆë‹¤.**

> **â€œì´ ì‚¬ëŒì€ ì–¸ì œ êµ¬í˜„ì„ ë©ˆì¶°ì•¼ í•˜ëŠ”ì§€ë„ ì•„ëŠ” ì—”ì§€ë‹ˆì–´ë‹¤â€**

> **ì´ ì¸ìƒì„ ë‚¨ê¸°ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.**

-----

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒë³„ ìƒì„¸ êµ¬í˜„ ê°€ì´ë“œ

### C# ê²Œì„ ì„œë²„ êµ¬í˜„ ê°€ì´ë“œ

#### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
GameServer/
â”œâ”€â”€ Program.cs                      # ì§„ì…ì 
â”œâ”€â”€ Network/
â”‚   â”œâ”€â”€ TcpServer.cs               # TCP ì„œë²„
â”‚   â”œâ”€â”€ Session.cs                 # í´ë¼ì´ì–¸íŠ¸ ì„¸ì…˜
â”‚   â”œâ”€â”€ PacketHandler.cs           # íŒ¨í‚· ì²˜ë¦¬
â”‚   â””â”€â”€ Serializer.cs              # MessagePack ì§ë ¬í™”
â”œâ”€â”€ GameLoop/
â”‚   â”œâ”€â”€ GameTick.cs                # ë©”ì¸ ê²Œì„ ë£¨í”„
â”‚   â””â”€â”€ CommandQueue.cs            # Command í
â”œâ”€â”€ Domain/
â”‚   â”œâ”€â”€ Player.cs                  # í”Œë ˆì´ì–´ ë„ë©”ì¸
â”‚   â”œâ”€â”€ World.cs                   # ê²Œì„ ì›”ë“œ
â”‚   â””â”€â”€ Commands/
â”‚       â”œâ”€â”€ MoveCommand.cs
â”‚       â””â”€â”€ ICommand.cs
â”œâ”€â”€ Events/
â”‚   â”œâ”€â”€ DomainEvent.cs             # ì´ë²¤íŠ¸ ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ PlayerMovedEvent.cs
â”‚   â””â”€â”€ EventPublisher.cs          # Kafka ë°œí–‰
â””â”€â”€ Infrastructure/
    â”œâ”€â”€ RedisClient.cs             # Redis ì—°ë™
    â””â”€â”€ KafkaProducer.cs           # Kafka ì—°ë™
```

#### í•µì‹¬ êµ¬í˜„ ì½”ë“œ

**1. TCP ì„œë²„ (TcpServer.cs)**

```csharp
public class TcpServer
{
    private readonly TcpListener _listener;
    private readonly Dictionary<string, Session> _sessions = new();
    
    public TcpServer(string host, int port)
    {
        _listener = new TcpListener(IPAddress.Parse(host), port);
    }
    
    public async Task StartAsync()
    {
        _listener.Start();
        Console.WriteLine($"[Server] Listening on {_listener.LocalEndpoint}");
        
        while (true)
        {
            var client = await _listener.AcceptTcpClientAsync();
            _ = HandleClientAsync(client); // Fire-and-forget
        }
    }
    
    private async Task HandleClientAsync(TcpClient client)
    {
        var session = new Session(client);
        _sessions[session.Id] = session;
        
        try
        {
            await session.StartReceiveAsync(OnPacketReceived);
        }
        finally
        {
            _sessions.Remove(session.Id);
            session.Dispose();
        }
    }
    
    private void OnPacketReceived(Session session, byte[] data)
    {
        // Packet â†’ Command ë³€í™˜
        var packet = MessagePackSerializer.Deserialize<Packet>(data);
        var command = PacketHandler.ToCommand(packet, session);
        
        // Command Queueì— ì ì¬
        GameLoop.Instance.EnqueueCommand(command);
    }
}
```

**2. ê²Œì„ ë£¨í”„ (GameTick.cs)**

```csharp
public class GameTick
{
    private readonly ConcurrentQueue<ICommand> _commandQueue = new();
    private readonly World _world = new();
    private readonly EventPublisher _eventPublisher;
    private const int TargetTickRate = 20; // 50ms
    
    public void EnqueueCommand(ICommand command)
    {
        _commandQueue.Enqueue(command);
    }
    
    public async Task RunAsync()
    {
        var interval = TimeSpan.FromMilliseconds(1000.0 / TargetTickRate);
        
        while (true)
        {
            var startTime = DateTime.UtcNow;
            
            // 1. Command ì²˜ë¦¬
            ProcessCommands();
            
            // 2. World Update
            _world.Update();
            
            // 3. Tick ì‹œê°„ ì¸¡ì •
            var elapsed = DateTime.UtcNow - startTime;
            if (elapsed > interval)
            {
                Console.WriteLine($"[Warning] Tick overrun: {elapsed.TotalMilliseconds}ms");
            }
            
            // 4. ë‹¤ìŒ Tickê¹Œì§€ ëŒ€ê¸°
            var delay = interval - elapsed;
            if (delay > TimeSpan.Zero)
            {
                await Task.Delay(delay);
            }
        }
    }
    
    private void ProcessCommands()
    {
        // ì´ë²ˆ Tickì—ì„œ ì²˜ë¦¬í•  Command ìˆ˜ ì œí•œ
        var processCount = Math.Min(_commandQueue.Count, 1000);
        
        for (int i = 0; i < processCount; i++)
        {
            if (!_commandQueue.TryDequeue(out var command))
                break;
            
            try
            {
                // Command ì‹¤í–‰ â†’ Domain Event ìƒì„±
                var events = command.Execute(_world);
                
                // Event ë°œí–‰ (Fire-and-Forget)
                foreach (var evt in events)
                {
                    _eventPublisher.PublishAsync(evt);
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"[Error] Command execution failed: {ex.Message}");
            }
        }
    }
}
```

**3. Command êµ¬í˜„ (MoveCommand.cs)**

```csharp
public class MoveCommand : ICommand
{
    public string PlayerId { get; set; }
    public Vector3 NewPosition { get; set; }
    
    public List<DomainEvent> Execute(World world)
    {
        var events = new List<DomainEvent>();
        var player = world.GetPlayer(PlayerId);
        
        if (player == null)
        {
            Console.WriteLine($"[Warning] Player not found: {PlayerId}");
            return events;
        }
        
        // Validation
        if (!ValidateMove(player, NewPosition))
        {
            Console.WriteLine($"[Reject] Invalid move: {PlayerId}");
            return events;
        }
        
        // State Change (ë©”ëª¨ë¦¬ì—ì„œ ì¦‰ì‹œ)
        var oldPosition = player.Position;
        player.Position = NewPosition;
        player.LastMoveTime = DateTime.UtcNow;
        
        // Domain Event ìƒì„±
        events.Add(new PlayerMovedEvent
        {
            EventId = Guid.NewGuid().ToString(),
            AggregateId = PlayerId,
            OccurredAt = DateTime.UtcNow,
            PlayerId = PlayerId,
            FromPosition = oldPosition,
            ToPosition = NewPosition
        });
        
        return events;
    }
    
    private bool ValidateMove(Player player, Vector3 newPosition)
    {
        // ê±°ë¦¬ ê²€ì¦
        var distance = Vector3.Distance(player.Position, newPosition);
        if (distance > player.MaxMoveDistance)
            return false;
        
        // ì¿¨ë‹¤ìš´ ê²€ì¦
        if (DateTime.UtcNow - player.LastMoveTime < player.MoveCooldown)
            return false;
        
        return true;
    }
}
```

**4. Kafka Producer (KafkaProducer.cs)**

```csharp
public class KafkaProducer
{
    private readonly IProducer<string, byte[]> _producer;
    
    public KafkaProducer(string bootstrapServers)
    {
        var config = new ProducerConfig
        {
            BootstrapServers = bootstrapServers,
            Acks = Acks.Leader, // Leaderë§Œ í™•ì¸ (ì†ë„ ìš°ì„ )
            EnableIdempotence = true
        };
        
        _producer = new ProducerBuilder<string, byte[]>(config).Build();
    }
    
    public async Task PublishAsync(DomainEvent evt)
    {
        try
        {
            // MessagePack ì§ë ¬í™”
            var data = MessagePackSerializer.Serialize(evt);
            
            var message = new Message<string, byte[]>
            {
                Key = evt.AggregateId, // ìˆœì„œ ë³´ì¥
                Value = data
            };
            
            // Fire-and-Forget (ê²°ê³¼ ëŒ€ê¸° ì•ˆ í•¨)
            _ = _producer.ProduceAsync("game.events.player", message);
        }
        catch (Exception ex)
        {
            // ì‹¤íŒ¨í•´ë„ ê²Œì„ ì§„í–‰ì— ì˜í–¥ ì—†ìŒ
            Console.WriteLine($"[Warning] Kafka publish failed: {ex.Message}");
        }
    }
}
```

#### í•„ìˆ˜ NuGet íŒ¨í‚¤ì§€

```xml
<ItemGroup>
  <PackageReference Include="MessagePack" Version="2.5.140" />
  <PackageReference Include="Confluent.Kafka" Version="2.3.0" />
  <PackageReference Include="StackExchange.Redis" Version="2.7.10" />
</ItemGroup>
```

-----

### TypeScript í”Œë«í¼ ì„œë²„ êµ¬í˜„ ê°€ì´ë“œ

#### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
platform-server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                   # ì§„ì…ì 
â”‚   â”œâ”€â”€ kafka/
â”‚   â”‚   â”œâ”€â”€ consumer.ts            # Kafka Consumer
â”‚   â”‚   â”œâ”€â”€ eventHandler.ts        # ì´ë²¤íŠ¸ ì²˜ë¦¬
â”‚   â”‚   â””â”€â”€ types.ts               # ì´ë²¤íŠ¸ íƒ€ì…
â”‚   â”œâ”€â”€ persistence/
â”‚   â”‚   â”œâ”€â”€ database.ts            # DB ì—°ê²°
â”‚   â”‚   â”œâ”€â”€ repositories/
â”‚   â”‚   â”‚   â”œâ”€â”€ playerRepository.ts
â”‚   â”‚   â”‚   â””â”€â”€ eventRepository.ts
â”‚   â”‚   â””â”€â”€ models/
â”‚   â”‚       â””â”€â”€ player.ts
â”‚   â”œâ”€â”€ cache/
â”‚   â”‚   â””â”€â”€ redis.ts               # Redis í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ server.ts              # Elysia ì„œë²„
â”‚       â””â”€â”€ routes/
â”‚           â””â”€â”€ players.ts
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

#### í•µì‹¬ êµ¬í˜„ ì½”ë“œ

**1. Kafka Consumer (consumer.ts)**

```typescript
import { Kafka, Consumer, EachMessagePayload } from 'kafkajs';
import { EventHandler } from './eventHandler';
import { DomainEvent } from './types';

export class KafkaConsumer {
  private kafka: Kafka;
  private consumer: Consumer;
  private eventHandler: EventHandler;
  
  constructor(brokers: string[]) {
    this.kafka = new Kafka({
      clientId: 'platform-server',
      brokers: brokers
    });
    
    this.consumer = this.kafka.consumer({
      groupId: 'platform-server-group'
    });
    
    this.eventHandler = new EventHandler();
  }
  
  async start() {
    await this.consumer.connect();
    console.log('[Kafka] Consumer connected');
    
    await this.consumer.subscribe({
      topics: ['game.events.player'],
      fromBeginning: false
    });
    
    await this.consumer.run({
      eachMessage: async (payload: EachMessagePayload) => {
        await this.handleMessage(payload);
      }
    });
  }
  
  private async handleMessage(payload: EachMessagePayload) {
    try {
      const { topic, partition, message } = payload;
      
      if (!message.value) return;
      
      // MessagePack ì—­ì§ë ¬í™” (C#ê³¼ í˜¸í™˜)
      const event = this.deserialize(message.value) as DomainEvent;
      
      console.log(`[Kafka] Received: ${event.type} (${event.eventId})`);
      
      // ì´ë²¤íŠ¸ ì²˜ë¦¬
      await this.eventHandler.handle(event);
      
    } catch (error) {
      console.error('[Kafka] Error handling message:', error);
      // DLQë¡œ ì „ì†¡í•˜ê±°ë‚˜ ì¬ì‹œë„ ë¡œì§
    }
  }
  
  private deserialize(buffer: Buffer): any {
    // MessagePack ì—­ì§ë ¬í™”
    // msgpackr ë˜ëŠ” @msgpack/msgpack ì‚¬ìš©
    return JSON.parse(buffer.toString()); // ì„ì‹œ: JSON ê°€ì •
  }
}
```

**2. Event Handler (eventHandler.ts)**

```typescript
import { Redis } from 'ioredis';
import { PlayerRepository } from '../persistence/repositories/playerRepository';
import { DomainEvent, PlayerMovedEvent } from './types';

export class EventHandler {
  private redis: Redis;
  private playerRepo: PlayerRepository;
  private processedEvents: Set<string>;
  
  constructor() {
    this.redis = new Redis({
      host: process.env.REDIS_HOST || 'localhost',
      port: 6379
    });
    
    this.playerRepo = new PlayerRepository();
    this.processedEvents = new Set();
  }
  
  async handle(event: DomainEvent) {
    // Idempotency ê²€ì¦
    if (await this.isProcessed(event.eventId)) {
      console.log(`[Event] Already processed: ${event.eventId}`);
      return;
    }
    
    try {
      // ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬
      switch (event.type) {
        case 'PlayerMovedEvent':
          await this.handlePlayerMoved(event as PlayerMovedEvent);
          break;
        // ë‹¤ë¥¸ ì´ë²¤íŠ¸ íƒ€ì…ë“¤...
      }
      
      // ì²˜ë¦¬ ì™„ë£Œ ê¸°ë¡
      await this.markProcessed(event.eventId);
      
    } catch (error) {
      console.error(`[Event] Failed to process: ${event.eventId}`, error);
      // DLQë¡œ ì „ì†¡
      await this.sendToDLQ(event, error);
    }
  }
  
  private async handlePlayerMoved(event: PlayerMovedEvent) {
    // DBì— ì´ë™ ê¸°ë¡ ì €ì¥
    await this.playerRepo.saveMovement({
      playerId: event.playerId,
      fromPosition: event.fromPosition,
      toPosition: event.toPosition,
      occurredAt: event.occurredAt
    });
    
    console.log(`[Event] Player moved: ${event.playerId}`);
  }
  
  private async isProcessed(eventId: string): Promise<boolean> {
    const key = `event:${eventId}`;
    const exists = await this.redis.exists(key);
    return exists === 1;
  }
  
  private async markProcessed(eventId: string): Promise<void> {
    const key = `event:${eventId}`;
    // TTL: 1ì‹œê°„
    await this.redis.setex(key, 3600, 'processed');
  }
  
  private async sendToDLQ(event: DomainEvent, error: any) {
    // DLQ Topicìœ¼ë¡œ ì „ì†¡
    // ë˜ëŠ” ë³„ë„ DB í…Œì´ë¸”ì— ì €ì¥
    console.error('[DLQ]', event.eventId, error.message);
  }
}
```

**3. Database (database.ts with Drizzle ORM)**

```typescript
import { drizzle } from 'drizzle-orm/mysql2';
import mysql from 'mysql2/promise';
import * as schema from './schema';

export const connection = await mysql.createConnection({
  host: process.env.DB_HOST || 'localhost',
  user: process.env.DB_USER || 'root',
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME || 'game_platform'
});

export const db = drizzle(connection, { schema, mode: 'default' });

// Schema ì •ì˜ (schema.ts)
import { mysqlTable, varchar, timestamp, json } from 'drizzle-orm/mysql-core';

export const playerMovements = mysqlTable('player_movements', {
  id: varchar('id', { length: 36 }).primaryKey(),
  playerId: varchar('player_id', { length: 36 }).notNull(),
  fromPosition: json('from_position').notNull(),
  toPosition: json('to_position').notNull(),
  occurredAt: timestamp('occurred_at').notNull(),
  createdAt: timestamp('created_at').defaultNow()
});
```

**4. Repository (playerRepository.ts)**

```typescript
import { db } from '../database';
import { playerMovements } from '../schema';
import { v4 as uuidv4 } from 'uuid';

export class PlayerRepository {
  async saveMovement(data: {
    playerId: string;
    fromPosition: { x: number; y: number; z: number };
    toPosition: { x: number; y: number; z: number };
    occurredAt: Date;
  }) {
    await db.insert(playerMovements).values({
      id: uuidv4(),
      playerId: data.playerId,
      fromPosition: data.fromPosition,
      toPosition: data.toPosition,
      occurredAt: data.occurredAt
    });
  }
  
  async getPlayerMovements(playerId: string, limit: number = 100) {
    return await db
      .select()
      .from(playerMovements)
      .where(eq(playerMovements.playerId, playerId))
      .orderBy(desc(playerMovements.occurredAt))
      .limit(limit);
  }
}
```

**5. API Server (server.ts with Elysia)**

```typescript
import { Elysia } from 'elysia';
import { PlayerRepository } from './persistence/repositories/playerRepository';

const playerRepo = new PlayerRepository();

const app = new Elysia()
  .get('/api/players/:playerId/movements', async ({ params }) => {
    const movements = await playerRepo.getPlayerMovements(params.playerId);
    return { data: movements };
  })
  .get('/health', () => ({ status: 'ok' }))
  .listen(3000);

console.log(`[API] Server running on ${app.server?.hostname}:${app.server?.port}`);
```

#### í•„ìˆ˜ íŒ¨í‚¤ì§€ (package.json)

```json
{
  "dependencies": {
    "elysia": "^0.8.0",
    "kafkajs": "^2.2.4",
    "drizzle-orm": "^0.29.0",
    "mysql2": "^3.6.5",
    "ioredis": "^5.3.2",
    "@msgpack/msgpack": "^3.0.0",
    "uuid": "^9.0.1"
  },
  "devDependencies": {
    "bun-types": "latest",
    "drizzle-kit": "^0.20.0"
  }
}
```

-----

### Unity í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ê°€ì´ë“œ

#### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
Assets/
â”œâ”€â”€ Scripts/
â”‚   â”œâ”€â”€ Network/
â”‚   â”‚   â”œâ”€â”€ NetworkClient.cs       # TCP í´ë¼ì´ì–¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ PacketSerializer.cs    # MessagePack ì§ë ¬í™”
â”‚   â”‚   â””â”€â”€ PacketHandler.cs       # íŒ¨í‚· ì²˜ë¦¬
â”‚   â”œâ”€â”€ Player/
â”‚   â”‚   â”œâ”€â”€ PlayerController.cs    # í”Œë ˆì´ì–´ ì…ë ¥
â”‚   â”‚   â””â”€â”€ PlayerView.cs          # í”Œë ˆì´ì–´ ë Œë”ë§
â”‚   â”œâ”€â”€ Bootstrap/
â”‚   â”‚   â””â”€â”€ GameBootstrap.cs       # ì´ˆê¸°í™”
â”‚   â””â”€â”€ Types/
â”‚       â”œâ”€â”€ Packet.cs
â”‚       â””â”€â”€ Command.cs
â””â”€â”€ Scenes/
    â””â”€â”€ GameScene.unity
```

#### í•µì‹¬ êµ¬í˜„ ì½”ë“œ

**1. Network Client (NetworkClient.cs)**

```csharp
using System;
using System.Net.Sockets;
using UnityEngine;
using MessagePack;

public class NetworkClient : MonoBehaviour
{
    private TcpClient _client;
    private NetworkStream _stream;
    private bool _isConnected;
    
    public event Action<Vector3> OnMoveConfirmed;
    public event Action<string> OnMoveRejected;
    
    public async void Connect(string host, int port)
    {
        try
        {
            _client = new TcpClient();
            await _client.ConnectAsync(host, port);
            _stream = _client.GetStream();
            _isConnected = true;
            
            Debug.Log($"[Network] Connected to {host}:{port}");
            
            // ìˆ˜ì‹  ì‹œì‘
            _ = ReceiveLoop();
        }
        catch (Exception ex)
        {
            Debug.LogError($"[Network] Connection failed: {ex.Message}");
        }
    }
    
    public void SendMoveRequest(Vector3 newPosition)
    {
        if (!_isConnected) return;
        
        var packet = new MoveRequestPacket
        {
            Type = "MoveRequest",
            NewPosition = newPosition
        };
        
        // MessagePack ì§ë ¬í™”
        var data = MessagePackSerializer.Serialize(packet);
        
        try
        {
            _stream.Write(data, 0, data.Length);
            Debug.Log($"[Network] Sent MoveRequest: {newPosition}");
        }
        catch (Exception ex)
        {
            Debug.LogError($"[Network] Send failed: {ex.Message}");
        }
    }
    
    private async System.Threading.Tasks.Task ReceiveLoop()
    {
        var buffer = new byte[4096];
        
        while (_isConnected)
        {
            try
            {
                var bytesRead = await _stream.ReadAsync(buffer, 0, buffer.Length);
                if (bytesRead == 0)
                {
                    Debug.Log("[Network] Server closed connection");
                    break;
                }
                
                // íŒ¨í‚· ì²˜ë¦¬
                ProcessPacket(buffer, bytesRead);
            }
            catch (Exception ex)
            {
                Debug.LogError($"[Network] Receive error: {ex.Message}");
                break;
            }
        }
        
        _isConnected = false;
    }
    
    private void ProcessPacket(byte[] data, int length)
    {
        // MessagePack ì—­ì§ë ¬í™”
        var packet = MessagePackSerializer.Deserialize<Packet>(data);
        
        switch (packet.Type)
        {
            case "MoveResponse":
                var response = packet as MoveResponsePacket;
                if (response.Success)
                {
                    OnMoveConfirmed?.Invoke(response.Position);
                }
                else
                {
                    OnMoveRejected?.Invoke(response.Reason);
                }
                break;
        }
    }
    
    private void OnDestroy()
    {
        _isConnected = false;
        _stream?.Close();
        _client?.Close();
    }
}
```

**2. Player Controller (PlayerController.cs)**

```csharp
using UnityEngine;

public class PlayerController : MonoBehaviour
{
    private NetworkClient _networkClient;
    private Vector3 _serverPosition;
    
    void Start()
    {
        _networkClient = FindObjectOfType<NetworkClient>();
        
        // ì´ë²¤íŠ¸ êµ¬ë…
        _networkClient.OnMoveConfirmed += OnServerMoveConfirmed;
        _networkClient.OnMoveRejected += OnServerMoveRejected;
        
        _serverPosition = transform.position;
    }
    
    void Update()
    {
        HandleInput();
    }
    
    private void HandleInput()
    {
        Vector3 moveDirection = Vector3.zero;
        
        if (Input.GetKeyDown(KeyCode.W))
            moveDirection = Vector3.forward;
        else if (Input.GetKeyDown(KeyCode.S))
            moveDirection = Vector3.back;
        else if (Input.GetKeyDown(KeyCode.A))
            moveDirection = Vector3.left;
        else if (Input.GetKeyDown(KeyCode.D))
            moveDirection = Vector3.right;
        
        if (moveDirection != Vector3.zero)
        {
            // ì˜ˆìƒ ìœ„ì¹˜ ê³„ì‚°
            var newPosition = transform.position + moveDirection;
            
            // ì„œë²„ì— ìš”ì²­ë§Œ ì „ì†¡ (ë¡œì»¬ì—ì„œ ì¦‰ì‹œ ë³€ê²½í•˜ì§€ ì•ŠìŒ!)
            _networkClient.SendMoveRequest(newPosition);
            
            Debug.Log($"[Client] Move requested: {newPosition}");
        }
    }
    
    // ì„œë²„ë¡œë¶€í„° ìŠ¹ì¸ëœ ìœ„ì¹˜ë§Œ ë°˜ì˜
    private void OnServerMoveConfirmed(Vector3 serverPosition)
    {
        transform.position = serverPosition;
        _serverPosition = serverPosition;
        
        Debug.Log($"[Client] Move confirmed by server: {serverPosition}");
    }
    
    // ì„œë²„ ê±°ë¶€ ì‹œ
    private void OnServerMoveRejected(string reason)
    {
        // ìœ„ì¹˜ë¥¼ ì„œë²„ ê¸°ì¤€ìœ¼ë¡œ êµì •
        transform.position = _serverPosition;
        
        Debug.LogWarning($"[Client] Move rejected: {reason}");
    }
    
    void OnDestroy()
    {
        if (_networkClient != null)
        {
            _networkClient.OnMoveConfirmed -= OnServerMoveConfirmed;
            _networkClient.OnMoveRejected -= OnServerMoveRejected;
        }
    }
}
```

**3. Game Bootstrap (GameBootstrap.cs)**

```csharp
using UnityEngine;

public class GameBootstrap : MonoBehaviour
{
    [SerializeField] private string serverHost = "localhost";
    [SerializeField] private int serverPort = 8080;
    [SerializeField] private GameObject playerPrefab;
    
    private NetworkClient _networkClient;
    
    void Start()
    {
        // Network Client ì´ˆê¸°í™”
        var clientObj = new GameObject("NetworkClient");
        _networkClient = clientObj.AddComponent<NetworkClient>();
        DontDestroyOnLoad(clientObj);
        
        // ì„œë²„ ì—°ê²°
        _networkClient.Connect(serverHost, serverPort);
        
        // í”Œë ˆì´ì–´ ìƒì„±
        var player = Instantiate(playerPrefab, Vector3.zero, Quaternion.identity);
        
        Debug.Log("[Bootstrap] Game initialized");
    }
}
```

#### í•„ìˆ˜ Unity íŒ¨í‚¤ì§€

```
MessagePack for C# (via NuGet for Unity)
ë˜ëŠ”
UniTask (async/await ì§€ì›)
```

#### READMEì— í¬í•¨í•  ì¤‘ìš” ë¬¸êµ¬

```markdown
## âš ï¸ Unity Client Architecture Note

**This Unity client intentionally avoids client-side authority.**

All state changes are applied **only after server confirmation**,
to demonstrate a strictly server-authoritative architecture.

The client may appear "laggy" or "unresponsive" - **this is by design**.
In a production game, client-side prediction would be added,
but the server-authoritative foundation remains the same.

### Visual Design

- âœ… Cube mesh is sufficient
- âœ… Choppy movement is acceptable
- âœ… Smooth interpolation is optional
- âœ… Debug UI is enough
```

-----

## ğŸ”— ê¸°ìˆ  ìŠ¤íƒ ê°„ ì—°ë™

### MessagePack í†µì‹  í”„ë¡œí† ì½œ

**C# (ê²Œì„ ì„œë²„)**

```csharp
[MessagePackObject]
public class MoveRequestPacket
{
    [Key(0)]
    public string Type { get; set; }
    
    [Key(1)]
    public Vector3 NewPosition { get; set; }
}
```

**TypeScript (í”Œë«í¼ ì„œë²„)**

```typescript
interface MoveRequestPacket {
  type: string;
  newPosition: { x: number; y: number; z: number };
}
```

**Unity (í´ë¼ì´ì–¸íŠ¸)**

```csharp
[MessagePackObject]
public class MoveRequestPacket
{
    [Key(0)]
    public string Type { get; set; }
    
    [Key(1)]
    public Vector3 NewPosition { get; set; }
}
```

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

**C# (.env)**

```
KAFKA_BOOTSTRAP_SERVERS=localhost:9092
REDIS_HOST=localhost
REDIS_PORT=6379
```

**TypeScript (.env)**

```
KAFKA_BROKERS=localhost:9092
REDIS_HOST=localhost
REDIS_PORT=6379
DB_HOST=localhost
DB_USER=root
DB_PASSWORD=
DB_NAME=game_platform
```

**Unity (Inspector)**

```
Server Host: localhost
Server Port: 8080
```

-----

## ğŸ“§ Contact

**Author**: [ì´ë¦„]  
**Email**: [ì´ë©”ì¼]  
**GitHub**: [ë§í¬]  
**Blog**: [ë§í¬]

-----

## ğŸ“– ì°¸ê³  ìë£Œ

ì´ ì„¤ê³„ëŠ” ë‹¤ìŒ ìë£Œë¥¼ ì°¸ê³ í•˜ì—¬ í•™ìŠµí•˜ê³  ì •ë¦¬í–ˆìŠµë‹ˆë‹¤:

- GDC Talk: â€œOverwatch Gameplay Architecture and Netcodeâ€
- AWS GameTech: â€œReal-time Multiplayer Game Server Architectureâ€
- Domain-Driven Design - Eric Evans
- Building Microservices - Sam Newman
- Designing Data-Intensive Applications - Martin Kleppmann

-----

## ğŸ“ License

ì´ ë¬¸ì„œëŠ” ì„¤ê³„ í¬íŠ¸í´ë¦¬ì˜¤ë¡œ, í•™ìŠµ ë° í‰ê°€ ëª©ì ìœ¼ë¡œ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤.

-----

**Last Updated**: 2024.01