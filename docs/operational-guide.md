# ìš´ì˜ ê°€ì´ë“œ

[â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°](../README.md)

---

## ğŸ“‹ ëª©ì°¨

1. [ìš´ì˜ ì² í•™](#ìš´ì˜-ì² í•™)
2. [ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ë³„ ëŒ€ì‘](#ì¥ì• -ì‹œë‚˜ë¦¬ì˜¤ë³„-ëŒ€ì‘)
3. [ë¬´ì¤‘ë‹¨ ë°°í¬](#ë¬´ì¤‘ë‹¨-ë°°í¬)
4. [ëª¨ë‹ˆí„°ë§](#ëª¨ë‹ˆí„°ë§)
5. [ì¬í•´ ë³µêµ¬ í›ˆë ¨](#ì¬í•´-ë³µêµ¬-í›ˆë ¨)

---

## ìš´ì˜ ì² í•™

> **"ì¥ì• ê°€ ë‚˜ì§€ ì•ŠëŠ” ê²ƒ"ë³´ë‹¤ "ì¥ì• ê°€ ë‚˜ë„ ì˜ˆì¸¡ ê°€ëŠ¥í•˜ê²Œ ë™ì‘í•˜ëŠ” ê²ƒ"**

ì´ ì„¤ê³„ëŠ” ë‹¤ìŒì„ ê°€ì •í•©ë‹ˆë‹¤:
- ì¥ì• ëŠ” ì–¸ì œë‚˜ ë°œìƒí•œë‹¤
- ëª¨ë“  ì‹œìŠ¤í…œì€ ì–¸ì  ê°€ ë‹¤ìš´ëœë‹¤
- ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì¥ì• ëŠ” í†µì œ ê°€ëŠ¥í•˜ë‹¤

### ì„¤ê³„ ëª©í‘œ

```
âœ“ ê²Œì„í”Œë ˆì´ëŠ” ë°±ì—”ë“œ ì¥ì• ì— ì˜í–¥ë°›ì§€ ì•ŠìŒ
âœ“ ì¥ì• ëŠ” êµ­ì†Œí™”ë˜ê³  ì „íŒŒë˜ì§€ ì•ŠìŒ
âœ“ ë³µêµ¬ëŠ” ìë™í™”ë˜ê±°ë‚˜ ë‹¨ìˆœí•œ ì ˆì°¨
âœ“ ìš´ì˜ìê°€ ìƒí™©ì„ ì¦‰ì‹œ íŒŒì•… ê°€ëŠ¥
```

---

## ì¥ì•  ì‹œë‚˜ë¦¬ì˜¤ë³„ ëŒ€ì‘

### ë³µêµ¬ ëª©í‘œê°’ (RTO / RPO)

| ì¥ì•  ëŒ€ìƒ | RTO (ë³µêµ¬ ì‹œê°„) | RPO (ë°ì´í„° ì†ì‹¤) | ë³µêµ¬ ë°©ì‹ |
|-----------|----------------|-------------------|-----------|
| ê²Œì„ ì„œë²„ | 10ì´ˆ | 5~10ì´ˆ | Redis Hot Snapshot â†’ ìë™ ë³µêµ¬ |
| Redis | 2~3ë¶„ | ì—†ìŒ | MongoDB Cold Snapshotìœ¼ë¡œ ì„ì‹œ ì „í™˜ |
| Kafka | ì¦‰ì‹œ | ì—†ìŒ | ë©”ëª¨ë¦¬ ë²„í¼ë§ â†’ ë³µêµ¬ í›„ ì¬ì „ì†¡ |
| MySQL | ë³µêµ¬ ì‹œì  | ì—†ìŒ | Kafkaì— ì´ë²¤íŠ¸ ëˆ„ì  â†’ ë³µêµ¬ í›„ ìë™ ì²˜ë¦¬ |
| í”Œë«í¼ ì„œë²„ | ìˆ˜ì´ˆ | ì—†ìŒ | ì¬ì‹œì‘ í›„ Consumer Offsetë¶€í„° ì¬ê°œ |

### ì¥ì•  ì˜í–¥ë„ ë§¤íŠ¸ë¦­ìŠ¤

| ì¥ì•  ëŒ€ìƒ | ê²Œì„í”Œë ˆì´ | ê¸°ë¡ | ìš´ì˜ API | ë³µêµ¬ ë‚œì´ë„ |
|-----------|------------|------|----------|-------------|
| ê²Œì„ ì„œë²„ | ğŸ”´ ì¤‘ë‹¨ | ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨ | ğŸŸ¢ ì •ìƒ | ë‚®ìŒ |
| Redis | ğŸŸ¡ ìˆœê°„ ì§€ì—° | ğŸŸ¢ ì •ìƒ | ğŸŸ¢ ì •ìƒ | ë‚®ìŒ |
| MongoDB | ğŸŸ¢ ì •ìƒ | ğŸŸ¢ ì •ìƒ | ğŸŸ¢ ì •ìƒ | ë‚®ìŒ |
| Kafka | ğŸŸ¢ ì •ìƒ | ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨ | ğŸŸ¢ ì •ìƒ | ì¤‘ê°„ |
| MySQL | ğŸŸ¢ ì •ìƒ | ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨ | ğŸ”´ ì¼ë¶€ ì‹¤íŒ¨ | ì¤‘ê°„ |
| í”Œë«í¼ ì„œë²„ | ğŸŸ¢ ì •ìƒ | ğŸŸ¡ ì¼ì‹œ ì¤‘ë‹¨ | ğŸ”´ ì¤‘ë‹¨ | ë‚®ìŒ |

---

### ì‹œë‚˜ë¦¬ì˜¤ 1: ê²Œì„ ì„œë²„ í¬ë˜ì‹œ

**ì¦ìƒ:** íŠ¹ì • Zone í”Œë ˆì´ì–´ ì „ì› ì—°ê²° ëŠê¹€, Health Check ì‹¤íŒ¨

**ìë™ ë³µêµ¬ í”„ë¡œì„¸ìŠ¤:**

```
[ ì¥ì•  ë°œìƒ ]
    â†“
[ Health Check ì‹¤íŒ¨ ê°ì§€ ]
    â†“
[ ìƒˆ ê²Œì„ ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ ì‹œì‘ ]
    â†“
[ Redis Hot Snapshot ë¡œë“œ ]
    â†“ (ìˆ˜ì´ˆ)
[ í”Œë ˆì´ì–´ ì„¸ì…˜ ë³µì› ]
    â†“
[ ê²Œì„ ì¬ê°œ ]  â†’ RTO: 10ì´ˆ
```

**ìˆ˜ë™ ëŒ€ì‘ (ì¬ë°œ ë°©ì§€ìš©):**
```bash
tail -f /var/log/game-server/crash.log          # ë¡œê·¸ í™•ì¸
gdb game-server core.dump                        # ì½”ì–´ ë¤í”„ ë¶„ì„
# â†’ í¬ë˜ì‹œ ì›ì¸ ë¶„ì„ í›„ í•«í”½ìŠ¤ ë°°í¬ ê³„íš
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: Redis ì¥ì• 

**ì¦ìƒ:** ìŠ¤ëƒ…ìƒ· ì €ì¥ ì‹¤íŒ¨, Session ê´€ë¦¬ ì—ëŸ¬, Rate Limiting ë¹„í™œì„±í™”

**ìë™ ë³µêµ¬ í”„ë¡œì„¸ìŠ¤:**

```
[ Redis ë‹¤ìš´ ê°ì§€ ]
    â†“
[ MongoDB Cold Snapshotìœ¼ë¡œ ì „í™˜ ]
    â†“
[ ê²Œì„ ì„œë²„: ì¼ì‹œì  ì„±ëŠ¥ ì €í•˜ (ìˆ˜ë°±ms) ]
    â†“ (ìˆ˜ë¶„ í›„)
[ Redis ë³µêµ¬ â†’ Hot Snapshot ì¬ê°œ ]
```

**ìˆ˜ë™ ëŒ€ì‘:**
```bash
redis-cli ping                                   # ìƒíƒœ í™•ì¸
redis-cli sentinel masters                       # Failover í™•ì¸
redis-cli --rdb /var/redis/dump.rdb              # ë°±ì—… ë³µêµ¬ (í•„ìš” ì‹œ)
systemctl restart redis
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: Kafka ì¥ì• 

**ì¦ìƒ:** ì´ë²¤íŠ¸ ë°œí–‰ ì‹¤íŒ¨ ë¡œê·¸ ì¦ê°€, Consumer Lag ê¸‰ì¦

**ìë™ ë³µêµ¬ í”„ë¡œì„¸ìŠ¤:**

```
[ Kafka ë‹¤ìš´ ]
    â†“
[ ê²Œì„ ì„œë²„: ì˜í–¥ ì—†ìŒ (ì¦‰ì‹œ íŒì • ê³„ì†) ]
    â†“
[ ì´ë²¤íŠ¸ëŠ” ë©”ëª¨ë¦¬ ë²„í¼ì— ì„ì‹œ ì €ì¥ (ìµœëŒ€ 10,000ê±´) ]
    â†“
[ Kafka ë³µêµ¬ ]
    â†“
[ ë²„í¼ë§ëœ ì´ë²¤íŠ¸ ì¼ê´„ ì „ì†¡ ]
```

> âš ï¸ ë²„í¼ ìš©ëŸ‰(10,000ê±´)ì„ ì´ˆê³¼í•˜ë©´ ì˜¤ë˜ëœ ì´ë²¤íŠ¸ê°€ íê¸°ë©ë‹ˆë‹¤. ì¥ê¸° ì¥ì•  ì‹œ DLQì™€ ìˆ˜ë™ ì¬ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

**ë²„í¼ êµ¬í˜„:**
```csharp
public class EventBuffer
{
    private readonly Queue<DomainEvent> _buffer = new();
    private const int MaxBufferSize = 10000;

    public void BufferEvent(DomainEvent evt)
    {
        if (_buffer.Count >= MaxBufferSize)
        {
            _buffer.Dequeue(); // FIFOë¡œ ì˜¤ë˜ëœ ì´ë²¤íŠ¸ ì œê±°
            Logger.Warn("Event buffer full, dropping old events");
        }
        _buffer.Enqueue(evt);
    }

    public async Task FlushBuffer()
    {
        while (_buffer.Count > 0)
        {
            var evt = _buffer.Dequeue();
            await kafka.PublishAsync(evt);
        }
    }
}
```

**ìˆ˜ë™ ëŒ€ì‘:**
```bash
kafka-topics.sh --describe --topic game.events.player              # Topic ìƒíƒœ í™•ì¸
kafka-consumer-groups.sh --describe --group platform-server-group  # Consumer Lag í™•ì¸
systemctl restart kafka
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: MySQL ì¥ì• 

**ì¦ìƒ:** í”Œë«í¼ ì„œë²„ DB ì¿¼ë¦¬ ì‹¤íŒ¨, ìš´ì˜ API ì—ëŸ¬ ì¦ê°€

**ì˜í–¥:** ê²Œì„í”Œë ˆì´ ë¬´ê´€, ê¸°ë¡ ì¼ì‹œ ì¤‘ë‹¨ (Kafkaì— ì´ë²¤íŠ¸ ëˆ„ì ), ìš´ì˜ API ì¼ë¶€ ì‹¤íŒ¨

**ìë™ ë³µêµ¬:** MySQL ë³µêµ¬ í›„ Kafkaì— ëˆ„ì ëœ ì´ë²¤íŠ¸ê°€ ìë™ ì²˜ë¦¬ë©ë‹ˆë‹¤.

**ìˆ˜ë™ ëŒ€ì‘:**
```bash
systemctl status mysql
mysql -e "SHOW SLAVE STATUS\G"                   # Replication í™•ì¸
mysql < backup.sql                               # ë°±ì—… ë³µêµ¬ (í•„ìš” ì‹œ)
systemctl restart mysql
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 5: í”Œë«í¼ ì„œë²„ ì¥ì• 

**ì¦ìƒ:** ìš´ì˜ API ì‘ë‹µ ì—†ìŒ, Kafka Consumer ì¤‘ë‹¨, ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ ë¶ˆê°€

**ì˜í–¥:** ê²Œì„í”Œë ˆì´ ë¬´ê´€, ê¸°ë¡ ì¼ì‹œ ì¤‘ë‹¨

**ìë™ ë³µêµ¬:**

```
[ í”Œë«í¼ ì„œë²„ ë‹¤ìš´ ]
    â†“
[ ê²Œì„ ì„œë²„: ì •ìƒ ë™ì‘ (Kafka ì´ë²¤íŠ¸ ëˆ„ì ) ]
    â†“
[ í”Œë«í¼ ì„œë²„ ì¬ì‹œì‘ ]
    â†“
[ Consumer Offsetë¶€í„° ì¬ê°œ â†’ ëˆ„ì  ì´ë²¤íŠ¸ ìˆœì°¨ ì²˜ë¦¬ ]
```

---

## ë¬´ì¤‘ë‹¨ ë°°í¬

### Rolling Update í”„ë¡œì„¸ìŠ¤

```
1. ìƒˆ ë²„ì „ ê²Œì„ ì„œë²„ ê¸°ë™
   â†“
2. Health Check í†µê³¼ í™•ì¸
   â†“
3. Load Balancerì— ì‹ ê·œ ì„œë²„ ë“±ë¡
   â†“
4. ì‹ ê·œ ì ‘ì†ìë§Œ ìƒˆ ì„œë²„ í• ë‹¹
   â†“
5. ê¸°ì¡´ ì„œë²„ëŠ” í”Œë ˆì´ì–´ 0ëª…ê¹Œì§€ ëŒ€ê¸°
   â†“
6. ìŠ¤ëƒ…ìƒ· ì €ì¥
   â†“
7. Graceful Shutdown
```

### ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ë°°í¬ ì „:**
```
â˜ ë²„ì „ í˜¸í™˜ì„± ê²€ì¦          â˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸
â˜ Rollback ê³„íš ìˆ˜ë¦½         â˜ ë°°í¬ ì‹œê°„ëŒ€ í™•ì¸ (ì €ì‚¬ìš© ì‹œê°„)
â˜ ìš´ì˜íŒ€ ëŒ€ê¸° í™•ì¸
```

**ë°°í¬ ì¤‘:**
```
â˜ ìƒˆ ë²„ì „ ì„œë²„ Health Check   â˜ ì—ëŸ¬ ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
â˜ ë©”ëª¨ë¦¬/CPU ì‚¬ìš©ë¥  ëª¨ë‹ˆí„°ë§    â˜ GameLoop Tick ì§€ì—° í™•ì¸
â˜ í”Œë ˆì´ì–´ ì´íƒˆë¥  í™•ì¸
```

**ë°°í¬ í›„:**
```
â˜ êµ¬ë²„ì „ ì„œë²„ ì™„ì „ ì¢…ë£Œ í™•ì¸    â˜ ìŠ¤ëƒ…ìƒ· ì €ì¥ ì„±ê³µ í™•ì¸
â˜ 24ì‹œê°„ ëª¨ë‹ˆí„°ë§             â˜ Rollback ëŒ€ê¸°
```

### Rollback ì ˆì°¨

```bash
kubectl scale deployment game-server-v2 --replicas=0       # ì‹ ê·œ ë²„ì „ ì œê±°
kubectl scale deployment game-server-v1 --replicas=3       # êµ¬ë²„ì „ ë³µì›
kubectl rollout undo deployment/game-server                 # ë¡œë“œë°¸ëŸ°ì„œ ì—…ë°ì´íŠ¸
kubectl get pods -l app=game-server                         # í™•ì¸
```

---

## ëª¨ë‹ˆí„°ë§

### ê²½ë³´ ì¡°ê±´

| ë ˆë²¨ | ì¡°ê±´ | ëŒ€ì‘ |
|------|------|------|
| ğŸš¨ **Critical** | ê²Œì„ ì„œë²„ ë‹¤ìš´ | ì¦‰ì‹œ ëŒ€ì‘ |
| ğŸš¨ **Critical** | Tick > 100ms ì§€ì† 30ì´ˆ | ì¦‰ì‹œ ëŒ€ì‘ |
| ğŸš¨ **Critical** | CCU ê¸‰ë½ 30% ì´ìƒ | ì¦‰ì‹œ ëŒ€ì‘ |
| ğŸš¨ **Critical** | Error Rate > 5% | ì¦‰ì‹œ ëŒ€ì‘ |
| ğŸš¨ **Critical** | DB ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ | ì¦‰ì‹œ ëŒ€ì‘ |
| âš ï¸ **Warning** | Command Queue > 1,000 | í™•ì¸ í•„ìš” |
| âš ï¸ **Warning** | Snapshot ì‹¤íŒ¨ ì—°ì† 3íšŒ | í™•ì¸ í•„ìš” |
| âš ï¸ **Warning** | Kafka Consumer Lag > 10,000 | í™•ì¸ í•„ìš” |
| âš ï¸ **Warning** | Tick > 70ms ì§€ì† 1ë¶„ | í™•ì¸ í•„ìš” |
| âš ï¸ **Warning** | CPU > 80% ì§€ì† 5ë¶„ | í™•ì¸ í•„ìš” |
| â„¹ï¸ **Info** | ì‹ ê·œ ë°°í¬ / ì •ê¸° ì ê²€ | ê´€ì°° |

### í•µì‹¬ ë©”íŠ¸ë¦­

**ê²Œì„ ì„œë²„:** Zoneë³„ CCU, CPU/Memory, GameLoop Tick ì§€ì—° (Target: < 50ms), Command Queue ê¸¸ì´, ì´ˆë‹¹ íŒ¨í‚· ìˆ˜, í‰ê·  RTT, íŒ¨í‚· ì†ì‹¤ë¥ 

**í”Œë«í¼ ì„œë²„:** Kafka Consumer Lag, ì´ë²¤íŠ¸ ì²˜ë¦¬ ì†ë„, DB ì»¤ë„¥ì…˜ í’€ ì‚¬ìš©ë¥ , API ì‘ë‹µ ì‹œê°„, ì—ëŸ¬ìœ¨

### ëŒ€ì‹œë³´ë“œ (ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Game Server Health                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Zone 1: 243 CCU | Tick: 45ms | âœ…   â”‚
â”‚ Zone 2: 189 CCU | Tick: 52ms | âœ…   â”‚
â”‚ Zone 3: 301 CCU | Tick: 48ms | âœ…   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kafka Status                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Topic: game.events.player           â”‚
â”‚ Messages/sec: 1,234                 â”‚
â”‚ Consumer Lag: 234                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì¬í•´ ë³µêµ¬ í›ˆë ¨

**ì£¼ê¸°:** ë¶„ê¸°ë³„ 1íšŒ | **ëª©í‘œ:** RTO/RPO ì‹¤ì œ ì¸¡ì •, ë³µêµ¬ ì ˆì°¨ ê²€ì¦, ìš´ì˜íŒ€ í›ˆë ¨

### ì‹œë‚˜ë¦¬ì˜¤ë³„ ì˜ˆìƒ RTO

| ì‹œë‚˜ë¦¬ì˜¤ | ë‚´ìš© | ì˜ˆìƒ RTO |
|----------|------|----------|
| 1 | Redis ê°•ì œ ì¤‘ë‹¨ â†’ MongoDB ë³µêµ¬ | 2~3ë¶„ |
| 2 | ì „ì²´ Zone ë‹¤ìš´ â†’ ìŠ¤ëƒ…ìƒ· ë³µêµ¬ + ì¬ê¸°ë™ | 5~10ë¶„ |
| 3 | ë°ì´í„°ì„¼í„° ì¥ì•  â†’ DR ì‚¬ì´íŠ¸ ì „í™˜ | 30ë¶„~1ì‹œê°„ |

### DR Drill ì²´í¬ë¦¬ìŠ¤íŠ¸

```
ë°°í¬ ì „:  â˜ ë°±ì—… ìµœì‹  ìƒíƒœ í™•ì¸  â˜ Runbook ê²€í†   â˜ ìš´ì˜íŒ€ êµìœ¡  â˜ ì•ŒëŒ í…ŒìŠ¤íŠ¸
ì‹¤í–‰ ì¤‘:  â˜ ì‹œê°„ ê¸°ë¡           â˜ ë¬¸ì œì  ê¸°ë¡   â˜ ì˜ì‚¬ê²°ì • ê¸°ë¡
ì‹¤í–‰ í›„:  â˜ RTO/RPO ë¶„ì„        â˜ ê°œì„ ì‚¬í•­ ë„ì¶œ  â˜ Runbook ì—…ë°ì´íŠ¸
```

---

## ìš´ì˜ Runbook

| ì£¼ê¸° | ì¼ì • | ë‚´ìš© |
|------|------|------|
| ì¼ì¼ | 08:00 / 12:00 / 18:00 / 22:00 | Health Check â†’ ë¡œê·¸ â†’ ë°±ì—… â†’ ì„±ëŠ¥ ë©”íŠ¸ë¦­ |
| ì£¼ê°„ | ì›” / ìˆ˜ / ê¸ˆ | ë°±ì—… í…ŒìŠ¤íŠ¸ â†’ ë³´ì•ˆ íŒ¨ì¹˜ ê²€í†  â†’ ì„±ëŠ¥ ë¦¬í¬íŠ¸ |
| ì›”ê°„ | 1~4ì£¼ì°¨ | DR Drill â†’ ìš©ëŸ‰ ê³„íš â†’ ë³´ì•ˆ ê°ì‚¬ â†’ ì„±ëŠ¥ ìµœì í™” |

---

[â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°](../README.md)